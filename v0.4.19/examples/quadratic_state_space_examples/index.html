<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quadratic State Space Examples · DifferenceEquations.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://DifferenceEquations.sciml.ai/stable/examples/quadratic_state_space_examples/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DifferenceEquations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DifferenceEquations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DifferenceEquations.jl: Discrete-Time State Space Solution Methods</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../linear_state_space_examples/">Linear State Space Examples</a></li><li class="is-active"><a class="tocitem" href>Quadratic State Space Examples</a><ul class="internal"><li><a class="tocitem" href="#Simulating-a-Quadratic-(and-Time-Invariant)-State-Space-Model"><span>Simulating a Quadratic (and Time-Invariant) State Space Model</span></a></li></ul></li><li><a class="tocitem" href="../general_state_space_examples/">General State Space Examples</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Quadratic State Space Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quadratic State Space Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DifferenceEquations.jl/blob/main/docs/src/examples/quadratic_state_space_examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Quadratic-State-Space-Examples"><a class="docs-heading-anchor" href="#Quadratic-State-Space-Examples">Quadratic State Space Examples</a><a id="Quadratic-State-Space-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Quadratic-State-Space-Examples" title="Permalink"></a></h1><p>Second-order state-space models here have pruning as in <a href="https://www.sas.upenn.edu/~jesusfv/Pruning.pdf">Andreasen, Fernandez-Villaverde, and Rubio-Ramirez (2017)</a>.</p><p>At this point, the package only supports linear time-invariant models without a separate <code>p</code> vector.  The canonical form is</p><p class="math-container">\[u_{n+1} = A_0 + A_1 u_n + u_n^{\top} A_2 u_n + B w_{n+1}\]</p><p>with</p><p class="math-container">\[z_n = C_0 + C_1 u_n + u_n^{\top} C_2 u_n +  v_n\]</p><p>and optionally <span>$v_n \sim N(0, D)$</span> and <span>$w_{n+1} \sim N(0,I)$</span>.  If you pass noise into the solver, it no longer needs to be Gaussian.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Quadratic state-space models do not have the full feature coverage relative to the linear models.  In particular the auto-differentiation rules are only currently implemented for the <code>logpdf</code> required for estimation, and the simulation doesn&#39;t have much flexibility on which model elements can be missing.</p></div></div><h2 id="Simulating-a-Quadratic-(and-Time-Invariant)-State-Space-Model"><a class="docs-heading-anchor" href="#Simulating-a-Quadratic-(and-Time-Invariant)-State-Space-Model">Simulating a Quadratic (and Time-Invariant) State Space Model</a><a id="Simulating-a-Quadratic-(and-Time-Invariant)-State-Space-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-a-Quadratic-(and-Time-Invariant)-State-Space-Model" title="Permalink"></a></h2><p>Creating a <code>QuadraticStateSpaceModel</code> is similar to the Linear version described previously. I  using DifferenceEquations, LinearAlgebra, Distributions, Random, Plots, DataFrames, Zygote, DiffEqBase A<em>0 =  [-7.824904812740593e-5, 0.0] A</em>1 = [0.95 6.2;      0.0  0.2] A<em>2 = cat([-0.0002 0.0334; 0.0 0.0],               [0.034 3.129; 0.0 0.0]; dims = 3) B = [0.0; 0.01;;] # matrix C</em>0 = [7.8e-5, 0.0] C<em>1 = [0.09 0.67;      1.00 0.00] C</em>2 = cat([-0.00019 0.0026; 0.0 0.0],     [0.0026 0.313; 0.0 0.0]; dims = 3) D = [0.01, 0.01] # diagonal observation noise u0 = zeros(2) T = 30</p><p>prob = QuadraticStateSpaceProblem(A<em>0, A</em>1, A<em>2, B, u0, (0, T); C</em>0, C<em>1, C</em>2, observables_noise = D, syms = [:a, :b]) sol = solve(prob)</p><pre><code class="nohighlight hljs">
As in the linear case, this model can be simulated and plotted</code></pre><p>@example 2 plot(sol)</p><pre><code class="nohighlight hljs">
And the observables and noise can be stored</code></pre><p>@example 2 observables = hcat(sol.z...)  # Observables required to be matrix.  Issue #55  observables = observables[:, 2:end] # see note above on likelihood and timing noise = sol.W</p><pre><code class="nohighlight hljs">
Ensembles work as well,
</code></pre><p>@example 2 trajectories = 50 u0<em>dist = MvNormal([1.0 0.1; 0.1 1.0])  # mean zero initial conditions prob = QuadraticStateSpaceProblem(A</em>0, A<em>1, A</em>2, B, u0<em>dist, (0, T); C</em>0, C<em>1, C</em>2, observables<em>noise = D, syms = [:a, :b]) ens</em>sol = solve(EnsembleProblem(prob), DirectIteration(), EnsembleThreads(); trajectories) summ = EnsembleSummary(ens_sol)  # calculate summarize statistics such as quantiles plot(summ)</p><pre><code class="nohighlight hljs">
## Joint Likelihood with Noise
To calculate the likelihood, the Kalman Filter is no longer applicable.  However, we can still calculate the joint likelihood we did in the linear examples.  Using the simulated observables and noise,
</code></pre><p>@example 2 function joint<em>likelihood</em>quad(A<em>0, A</em>1, A<em>2, B, C</em>0, C<em>1, C</em>2, D, u0, noise, observables)     prob = QuadraticStateSpaceProblem(A<em>0, A</em>1, A<em>2, B, u0, (0, size(observables,2)); C</em>0, C<em>1, C</em>2, observables, observables<em>noise = D, noise)     return solve(prob).logpdf end u0 = [0.0, 0.0] joint</em>likelihood<em>quad(A</em>0, A<em>1, A</em>2, B, C<em>0, C</em>1, C_2, D, u0, noise, observables)</p><pre><code class="nohighlight hljs">Which, in turn can itself be differentiated.
</code></pre><p>@example 2 gradient((A<em>0, A</em>1, A<em>2, B, C</em>0, C<em>1, C</em>2, noise) -&gt; joint<em>likelihood</em>quad(A<em>0, A</em>1, A<em>2, B, C</em>0, C<em>1, C</em>2, D, u0, noise, observables), A<em>0, A</em>1, A<em>2, B, C</em>0, C<em>1, C</em>2, noise) ``` Note that this is calculating the gradient of the likelihood with respect to the underlying canonical representations for the quadratic state space form, but also the entire noise vector.</p><p>As in the linear case, this likelihood calculation can nested such that a separate differentiable function could generate the quadratic state space model and the gradients could be over a smaller set of structural parameters.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../linear_state_space_examples/">« Linear State Space Examples</a><a class="docs-footer-nextpage" href="../general_state_space_examples/">General State Space Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Friday 12 August 2022 23:38">Friday 12 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
