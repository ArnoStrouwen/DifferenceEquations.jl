<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear State Space Examples · DifferenceEquations.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://DifferenceEquations.sciml.ai/stable/examples/linear_state_space_examples/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DifferenceEquations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DifferenceEquations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DifferenceEquations.jl: Discrete-Time State Space Solution Methods</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Linear State Space Examples</a><ul class="internal"><li><a class="tocitem" href="#Simulating-a-Linear-(and-Time-Invariant)-State-Space-Model"><span>Simulating a Linear (and Time-Invariant) State Space Model</span></a></li><li><a class="tocitem" href="#Simulating-Ensembles-and-Fixing-Noise"><span>Simulating Ensembles and Fixing Noise</span></a></li><li><a class="tocitem" href="#Observables-and-Marginal-Likelihood-using-a-Kalman-Filter"><span>Observables and Marginal Likelihood using a Kalman Filter</span></a></li><li><a class="tocitem" href="#Joint-Likelihood-with-Noise"><span>Joint Likelihood with Noise</span></a></li><li><a class="tocitem" href="#Composition-of-State-Space-Models-and-AD"><span>Composition of State Space Models and AD</span></a></li><li><a class="tocitem" href="#Caveats-on-Gradients-and-Performance"><span>Caveats on Gradients and Performance</span></a></li></ul></li><li><a class="tocitem" href="../quadratic_state_space_examples/">Quadratic State Space Examples</a></li><li><a class="tocitem" href="../general_state_space_examples/">General State Space Examples</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Linear State Space Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear State Space Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DifferenceEquations.jl/blob/main/docs/src/examples/linear_state_space_examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Linear-State-Space-Examples"><a class="docs-heading-anchor" href="#Linear-State-Space-Examples">Linear State Space Examples</a><a id="Linear-State-Space-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-State-Space-Examples" title="Permalink"></a></h1><p>This tutorial provides describes the support for linear and linear gaussian state space models.</p><p>At this point, the package only supports linear time-invariant models without a separate <code>p</code> vector.  The canonical form of the linear model is</p><p class="math-container">\[u_{n+1} = A u_n + B w_{n+1}\]</p><p>with</p><p class="math-container">\[z_n = C u_n +  v_n\]</p><p>and optionally <span>$v_n \sim N(0, D)$</span> and <span>$w_{n+1} \sim N(0,I)$</span>.  If you pass noise into the solver, it no longer needs to be Gaussian.  More generally, support could be added for <span>$u_{n+1} = A(p,n) u_n + B(p,n) w_{n+1}$</span> where <span>$p$</span> is a vector of differentiable parameters, and the <span>$A$</span> and <span>$B$</span> are potentially matrix-free operators.</p><h2 id="Simulating-a-Linear-(and-Time-Invariant)-State-Space-Model"><a class="docs-heading-anchor" href="#Simulating-a-Linear-(and-Time-Invariant)-State-Space-Model">Simulating a Linear (and Time-Invariant) State Space Model</a><a id="Simulating-a-Linear-(and-Time-Invariant)-State-Space-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-a-Linear-(and-Time-Invariant)-State-Space-Model" title="Permalink"></a></h2><p>Creating a <code>LinearStateSpaceProblem</code> and simulating it for a simple, linear equation.</p><pre><code class="language-julia hljs">using DifferenceEquations, LinearAlgebra, Distributions, Random, Plots, DataFrames, Zygote
A = [0.95 6.2;
     0.0  0.2]
B = [0.0; 0.01;;] # matrix
C = [0.09 0.67;
     1.00 0.00]
D = [0.1, 0.1] # diagonal observation noise
u0 = zeros(2)
T = 10

prob = LinearStateSpaceProblem(A, B, u0, (0, T); C, observables_noise = D, syms = [:a, :b])
sol = solve(prob)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: Piecewise constant interpolation
t: 0:10
u: 11-element Vector{Vector{Float64}}:
 [0.0, 0.0]
 [0.0, -0.0033055183602664624]
 [-0.020494213833652068, -0.012736109912669335]
 [-0.09843338460051934, -0.00339036759919566]
 [-0.11453199448550647, -0.005784926834562136]
 [-0.14467194113551637, 0.006850663589071954]
 [-0.09496422982649444, -0.005516071573007163]
 [-0.12441566208781413, -0.008072679890898023]
 [-0.16824549430699115, -0.005642008936050115]
 [-0.19481367499515231, -0.02810831548040742]
 [-0.35934454722392073, -0.012207124075029649]</code></pre><p>The <code>u</code> vector of the simulated solution can be plotted using standard recipes, including use of the optional <code>syms</code>.  See <a href="https://diffeq.sciml.ai/latest/basics/plot/">SciML docs</a> for more options.</p><pre><code class="language-julia hljs">plot(sol)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip800">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip800)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip801">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip800)" d="
M86.9921 1505.26 L2352.76 1505.26 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip802">
    <rect x="86" y="47" width="2267" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  540.145,1505.26 540.145,47.2441 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  993.298,1505.26 993.298,47.2441 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1446.45,1505.26 1446.45,47.2441 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1899.6,1505.26 1899.6,47.2441 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2352.76,1505.26 2352.76,47.2441 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,1486.36 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  540.145,1505.26 540.145,1486.36 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  993.298,1505.26 993.298,1486.36 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1446.45,1505.26 1446.45,1486.36 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1899.6,1505.26 1899.6,1486.36 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2352.76,1505.26 2352.76,1486.36 
  "/>
<path clip-path="url(#clip800)" d="M86.9921 1536.18 Q83.381 1536.18 81.5523 1539.74 Q79.7468 1543.28 79.7468 1550.41 Q79.7468 1557.52 81.5523 1561.09 Q83.381 1564.63 86.9921 1564.63 Q90.6264 1564.63 92.4319 1561.09 Q94.2606 1557.52 94.2606 1550.41 Q94.2606 1543.28 92.4319 1539.74 Q90.6264 1536.18 86.9921 1536.18 M86.9921 1532.47 Q92.8023 1532.47 95.8578 1537.08 Q98.9365 1541.66 98.9365 1550.41 Q98.9365 1559.14 95.8578 1563.75 Q92.8023 1568.33 86.9921 1568.33 Q81.182 1568.33 78.1033 1563.75 Q75.0477 1559.14 75.0477 1550.41 Q75.0477 1541.66 78.1033 1537.08 Q81.182 1532.47 86.9921 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M534.798 1563.72 L551.117 1563.72 L551.117 1567.66 L529.173 1567.66 L529.173 1563.72 Q531.835 1560.97 536.418 1556.34 Q541.025 1551.69 542.205 1550.35 Q544.45 1547.82 545.33 1546.09 Q546.233 1544.33 546.233 1542.64 Q546.233 1539.88 544.288 1538.15 Q542.367 1536.41 539.265 1536.41 Q537.066 1536.41 534.613 1537.17 Q532.182 1537.94 529.404 1539.49 L529.404 1534.77 Q532.228 1533.63 534.682 1533.05 Q537.136 1532.47 539.173 1532.47 Q544.543 1532.47 547.737 1535.16 Q550.932 1537.85 550.932 1542.34 Q550.932 1544.47 550.122 1546.39 Q549.335 1548.28 547.228 1550.88 Q546.649 1551.55 543.548 1554.77 Q540.446 1557.96 534.798 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M996.307 1537.17 L984.501 1555.62 L996.307 1555.62 L996.307 1537.17 M995.08 1533.1 L1000.96 1533.1 L1000.96 1555.62 L1005.89 1555.62 L1005.89 1559.51 L1000.96 1559.51 L1000.96 1567.66 L996.307 1567.66 L996.307 1559.51 L980.705 1559.51 L980.705 1555 L995.08 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M1446.86 1548.52 Q1443.71 1548.52 1441.86 1550.67 Q1440.03 1552.82 1440.03 1556.57 Q1440.03 1560.3 1441.86 1562.47 Q1443.71 1564.63 1446.86 1564.63 Q1450 1564.63 1451.83 1562.47 Q1453.68 1560.3 1453.68 1556.57 Q1453.68 1552.82 1451.83 1550.67 Q1450 1548.52 1446.86 1548.52 M1456.14 1533.86 L1456.14 1538.12 Q1454.38 1537.29 1452.57 1536.85 Q1450.79 1536.41 1449.03 1536.41 Q1444.4 1536.41 1441.95 1539.53 Q1439.52 1542.66 1439.17 1548.98 Q1440.54 1546.97 1442.6 1545.9 Q1444.66 1544.81 1447.13 1544.81 Q1452.34 1544.81 1455.35 1547.98 Q1458.38 1551.13 1458.38 1556.57 Q1458.38 1561.9 1455.24 1565.11 Q1452.09 1568.33 1446.86 1568.33 Q1440.86 1568.33 1437.69 1563.75 Q1434.52 1559.14 1434.52 1550.41 Q1434.52 1542.22 1438.41 1537.36 Q1442.3 1532.47 1448.85 1532.47 Q1450.61 1532.47 1452.39 1532.82 Q1454.19 1533.17 1456.14 1533.86 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M1899.6 1551.25 Q1896.27 1551.25 1894.35 1553.03 Q1892.45 1554.81 1892.45 1557.94 Q1892.45 1561.06 1894.35 1562.85 Q1896.27 1564.63 1899.6 1564.63 Q1902.94 1564.63 1904.86 1562.85 Q1906.78 1561.04 1906.78 1557.94 Q1906.78 1554.81 1904.86 1553.03 Q1902.96 1551.25 1899.6 1551.25 M1894.93 1549.26 Q1891.92 1548.52 1890.23 1546.46 Q1888.56 1544.4 1888.56 1541.43 Q1888.56 1537.29 1891.5 1534.88 Q1894.46 1532.47 1899.6 1532.47 Q1904.77 1532.47 1907.7 1534.88 Q1910.64 1537.29 1910.64 1541.43 Q1910.64 1544.4 1908.95 1546.46 Q1907.29 1548.52 1904.3 1549.26 Q1907.68 1550.04 1909.56 1552.34 Q1911.45 1554.63 1911.45 1557.94 Q1911.45 1562.96 1908.38 1565.65 Q1905.32 1568.33 1899.6 1568.33 Q1893.89 1568.33 1890.81 1565.65 Q1887.75 1562.96 1887.75 1557.94 Q1887.75 1554.63 1889.65 1552.34 Q1891.55 1550.04 1894.93 1549.26 M1893.21 1541.87 Q1893.21 1544.56 1894.88 1546.06 Q1896.57 1547.57 1899.6 1547.57 Q1902.61 1547.57 1904.3 1546.06 Q1906.02 1544.56 1906.02 1541.87 Q1906.02 1539.19 1904.3 1537.68 Q1902.61 1536.18 1899.6 1536.18 Q1896.57 1536.18 1894.88 1537.68 Q1893.21 1539.19 1893.21 1541.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M2327.44 1563.72 L2335.08 1563.72 L2335.08 1537.36 L2326.77 1539.03 L2326.77 1534.77 L2335.04 1533.1 L2339.71 1533.1 L2339.71 1563.72 L2347.35 1563.72 L2347.35 1567.66 L2327.44 1567.66 L2327.44 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M2366.8 1536.18 Q2363.18 1536.18 2361.36 1539.74 Q2359.55 1543.28 2359.55 1550.41 Q2359.55 1557.52 2361.36 1561.09 Q2363.18 1564.63 2366.8 1564.63 Q2370.43 1564.63 2372.23 1561.09 Q2374.06 1557.52 2374.06 1550.41 Q2374.06 1543.28 2372.23 1539.74 Q2370.43 1536.18 2366.8 1536.18 M2366.8 1532.47 Q2372.61 1532.47 2375.66 1537.08 Q2378.74 1541.66 2378.74 1550.41 Q2378.74 1559.14 2375.66 1563.75 Q2372.61 1568.33 2366.8 1568.33 Q2360.99 1568.33 2357.91 1563.75 Q2354.85 1559.14 2354.85 1550.41 Q2354.85 1541.66 2357.91 1537.08 Q2360.99 1532.47 2366.8 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M1218.94 1604.35 L1218.94 1614.48 L1231 1614.48 L1231 1619.03 L1218.94 1619.03 L1218.94 1638.38 Q1218.94 1642.74 1220.11 1643.98 Q1221.32 1645.22 1224.98 1645.22 L1231 1645.22 L1231 1650.12 L1224.98 1650.12 Q1218.2 1650.12 1215.62 1647.61 Q1213.05 1645.06 1213.05 1638.38 L1213.05 1619.03 L1208.75 1619.03 L1208.75 1614.48 L1213.05 1614.48 L1213.05 1604.35 L1218.94 1604.35 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1241.09 2352.76,1241.09 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,865.472 2352.76,865.472 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,489.857 2352.76,489.857 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,114.241 2352.76,114.241 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1241.09 105.89,1241.09 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,865.472 105.89,865.472 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,489.857 105.89,489.857 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,114.241 105.89,114.241 
  "/>
<path clip-path="url(#clip800)" d="M-55.3036 1241.54 L-25.6278 1241.54 L-25.6278 1245.47 L-55.3036 1245.47 L-55.3036 1241.54 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-5.53535 1226.89 Q-9.14644 1226.89 -10.9751 1230.45 Q-12.7807 1233.99 -12.7807 1241.12 Q-12.7807 1248.23 -10.9751 1251.79 Q-9.14644 1255.34 -5.53535 1255.34 Q-1.90111 1255.34 -0.0955632 1251.79 Q1.73313 1248.23 1.73313 1241.12 Q1.73313 1233.99 -0.0955632 1230.45 Q-1.90111 1226.89 -5.53535 1226.89 M-5.53535 1223.18 Q0.274805 1223.18 3.33034 1227.79 Q6.40903 1232.37 6.40903 1241.12 Q6.40903 1249.85 3.33034 1254.46 Q0.274805 1259.04 -5.53535 1259.04 Q-11.3455 1259.04 -14.4242 1254.46 Q-17.4797 1249.85 -17.4797 1241.12 Q-17.4797 1232.37 -14.4242 1227.79 Q-11.3455 1223.18 -5.53535 1223.18 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M14.6266 1252.49 L19.5108 1252.49 L19.5108 1258.37 L14.6266 1258.37 L14.6266 1252.49 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M43.8625 1239.73 Q47.219 1240.45 49.094 1242.72 Q50.9921 1244.99 50.9921 1248.32 Q50.9921 1253.44 47.4736 1256.24 Q43.9551 1259.04 37.4737 1259.04 Q35.2978 1259.04 32.983 1258.6 Q30.6913 1258.18 28.2376 1257.33 L28.2376 1252.81 Q30.1821 1253.95 32.4969 1254.53 Q34.8117 1255.1 37.3348 1255.1 Q41.7329 1255.1 44.0246 1253.37 Q46.3394 1251.63 46.3394 1248.32 Q46.3394 1245.27 44.1866 1243.55 Q42.057 1241.82 38.2376 1241.82 L34.2098 1241.82 L34.2098 1237.97 L38.4227 1237.97 Q41.8718 1237.97 43.7005 1236.61 Q45.5292 1235.22 45.5292 1232.63 Q45.5292 1229.97 43.6311 1228.55 Q41.7561 1227.12 38.2376 1227.12 Q36.3163 1227.12 34.1172 1227.53 Q31.9182 1227.95 29.2793 1228.83 L29.2793 1224.66 Q31.9413 1223.92 34.2561 1223.55 Q36.5941 1223.18 38.6542 1223.18 Q43.9783 1223.18 47.0801 1225.61 Q50.1819 1228.02 50.1819 1232.14 Q50.1819 1235.01 48.5384 1237 Q46.8949 1238.97 43.8625 1239.73 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-54.3545 865.924 L-24.6788 865.924 L-24.6788 869.859 L-54.3545 869.859 L-54.3545 865.924 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-4.58628 851.271 Q-8.19737 851.271 -10.0261 854.836 Q-11.8316 858.377 -11.8316 865.507 Q-11.8316 872.613 -10.0261 876.178 Q-8.19737 879.72 -4.58628 879.72 Q-0.95204 879.72 0.853506 876.178 Q2.6822 872.613 2.6822 865.507 Q2.6822 858.377 0.853506 854.836 Q-0.95204 851.271 -4.58628 851.271 M-4.58628 847.567 Q1.22387 847.567 4.27941 852.174 Q7.3581 856.757 7.3581 865.507 Q7.3581 874.234 4.27941 878.84 Q1.22387 883.423 -4.58628 883.423 Q-10.3964 883.423 -13.4751 878.84 Q-16.5307 874.234 -16.5307 865.507 Q-16.5307 856.757 -13.4751 852.174 Q-10.3964 847.567 -4.58628 847.567 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M15.5756 876.873 L20.4599 876.873 L20.4599 882.752 L15.5756 882.752 L15.5756 876.873 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M34.6728 878.817 L50.9921 878.817 L50.9921 882.752 L29.0478 882.752 L29.0478 878.817 Q31.7098 876.062 36.2931 871.433 Q40.8996 866.78 42.0801 865.437 Q44.3255 862.914 45.2051 861.178 Q46.1079 859.419 46.1079 857.729 Q46.1079 854.975 44.1635 853.238 Q42.2422 851.502 39.1403 851.502 Q36.9413 851.502 34.4876 852.266 Q32.057 853.03 29.2793 854.581 L29.2793 849.859 Q32.1033 848.725 34.557 848.146 Q37.0107 847.567 39.0477 847.567 Q44.4181 847.567 47.6125 850.252 Q50.8069 852.938 50.8069 857.428 Q50.8069 859.558 49.9968 861.479 Q49.2097 863.377 47.1033 865.97 Q46.5246 866.641 43.4227 869.859 Q40.3209 873.053 34.6728 878.817 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-54.7249 490.308 L-25.0491 490.308 L-25.0491 494.243 L-54.7249 494.243 L-54.7249 490.308 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-4.95665 475.655 Q-8.56774 475.655 -10.3964 479.22 Q-12.202 482.762 -12.202 489.891 Q-12.202 496.998 -10.3964 500.562 Q-8.56774 504.104 -4.95665 504.104 Q-1.32241 504.104 0.483137 500.562 Q2.31183 496.998 2.31183 489.891 Q2.31183 482.762 0.483137 479.22 Q-1.32241 475.655 -4.95665 475.655 M-4.95665 471.952 Q0.853506 471.952 3.90904 476.558 Q6.98773 481.141 6.98773 489.891 Q6.98773 498.618 3.90904 503.224 Q0.853506 507.808 -4.95665 507.808 Q-10.7668 507.808 -13.8455 503.224 Q-16.901 498.618 -16.901 489.891 Q-16.901 481.141 -13.8455 476.558 Q-10.7668 471.952 -4.95665 471.952 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M15.2053 501.257 L20.0895 501.257 L20.0895 507.137 L15.2053 507.137 L15.2053 501.257 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M31.0848 503.201 L38.7237 503.201 L38.7237 476.836 L30.4135 478.502 L30.4135 474.243 L38.6774 472.577 L43.3533 472.577 L43.3533 503.201 L50.9921 503.201 L50.9921 507.137 L31.0848 507.137 L31.0848 503.201 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M-6.18349 100.04 Q-9.79459 100.04 -11.6233 103.604 Q-13.4288 107.146 -13.4288 114.276 Q-13.4288 121.382 -11.6233 124.947 Q-9.79459 128.488 -6.18349 128.488 Q-2.54925 128.488 -0.743708 124.947 Q1.08499 121.382 1.08499 114.276 Q1.08499 107.146 -0.743708 103.604 Q-2.54925 100.04 -6.18349 100.04 M-6.18349 96.3359 Q-0.37334 96.3359 2.6822 100.942 Q5.76089 105.526 5.76089 114.276 Q5.76089 123.002 2.6822 127.609 Q-0.37334 132.192 -6.18349 132.192 Q-11.9936 132.192 -15.0723 127.609 Q-18.1279 123.002 -18.1279 114.276 Q-18.1279 105.526 -15.0723 100.942 Q-11.9936 96.3359 -6.18349 96.3359 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M13.9784 125.641 L18.8627 125.641 L18.8627 131.521 L13.9784 131.521 L13.9784 125.641 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip800)" d="M39.0477 100.04 Q35.4367 100.04 33.608 103.604 Q31.8024 107.146 31.8024 114.276 Q31.8024 121.382 33.608 124.947 Q35.4367 128.488 39.0477 128.488 Q42.682 128.488 44.4875 124.947 Q46.3162 121.382 46.3162 114.276 Q46.3162 107.146 44.4875 103.604 Q42.682 100.04 39.0477 100.04 M39.0477 96.3359 Q44.8579 96.3359 47.9134 100.942 Q50.9921 105.526 50.9921 114.276 Q50.9921 123.002 47.9134 127.609 Q44.8579 132.192 39.0477 132.192 Q33.2376 132.192 30.1589 127.609 Q27.1034 123.002 27.1034 114.276 Q27.1034 105.526 30.1589 100.942 Q33.2376 96.3359 39.0477 96.3359 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip802)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,114.241 313.569,114.241 540.145,191.22 766.721,483.972 993.298,544.441 1219.87,657.651 1446.45,470.941 1673.03,581.566 1899.6,746.197 2126.18,845.992 
  2352.76,1464 
  "/>
<polyline clip-path="url(#clip802)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,114.241 313.569,126.657 540.145,162.08 766.721,126.976 993.298,135.97 1219.87,88.5087 1446.45,134.96 1673.03,144.563 1899.6,135.433 2126.18,219.82 
  2352.76,160.093 
  "/>
<path clip-path="url(#clip800)" d="
M2002.28 251.365 L2277.23 251.365 L2277.23 95.8446 L2002.28 95.8446  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2002.28,251.365 2277.23,251.365 2277.23,95.8446 2002.28,95.8446 2002.28,251.365 
  "/>
<polyline clip-path="url(#clip800)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,147.685 2178.51,147.685 
  "/>
<path clip-path="url(#clip800)" d="M2217.09 151.932 Q2211.93 151.932 2209.94 153.113 Q2207.95 154.293 2207.95 157.141 Q2207.95 159.409 2209.43 160.752 Q2210.93 162.071 2213.5 162.071 Q2217.04 162.071 2219.17 159.571 Q2221.32 157.048 2221.32 152.881 L2221.32 151.932 L2217.09 151.932 M2225.58 150.173 L2225.58 164.965 L2221.32 164.965 L2221.32 161.029 Q2219.87 163.391 2217.69 164.525 Q2215.51 165.636 2212.37 165.636 Q2208.38 165.636 2206.02 163.414 Q2203.69 161.168 2203.69 157.418 Q2203.69 153.043 2206.6 150.821 Q2209.54 148.599 2215.35 148.599 L2221.32 148.599 L2221.32 148.182 Q2221.32 145.243 2219.38 143.645 Q2217.46 142.025 2213.96 142.025 Q2211.74 142.025 2209.63 142.557 Q2207.53 143.09 2205.58 144.155 L2205.58 140.219 Q2207.92 139.317 2210.12 138.877 Q2212.32 138.414 2214.4 138.414 Q2220.03 138.414 2222.81 141.33 Q2225.58 144.247 2225.58 150.173 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip800)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,199.525 2178.51,199.525 
  "/>
<path clip-path="url(#clip800)" d="M2222.46 203.865 Q2222.46 199.166 2220.51 196.504 Q2218.59 193.819 2215.21 193.819 Q2211.83 193.819 2209.89 196.504 Q2207.97 199.166 2207.97 203.865 Q2207.97 208.564 2209.89 211.249 Q2211.83 213.911 2215.21 213.911 Q2218.59 213.911 2220.51 211.249 Q2222.46 208.564 2222.46 203.865 M2207.97 194.814 Q2209.31 192.499 2211.35 191.388 Q2213.41 190.254 2216.26 190.254 Q2220.98 190.254 2223.92 194.004 Q2226.88 197.754 2226.88 203.865 Q2226.88 209.976 2223.92 213.726 Q2220.98 217.476 2216.26 217.476 Q2213.41 217.476 2211.35 216.365 Q2209.31 215.231 2207.97 212.916 L2207.97 216.805 L2203.69 216.805 L2203.69 180.786 L2207.97 180.786 L2207.97 194.814 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>By default the solution provides an interface to access the simulated <code>u</code>.  That is, <code>sol.u[...] = sol[...]</code>,</p><pre><code class="language-julia hljs">sol[2]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Float64}:
  0.0
 -0.0033055183602664624</code></pre><p>Or to get the first element of the last step</p><pre><code class="language-julia hljs">sol[end][1] #first element of last step</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-0.35934454722392073</code></pre><p>Finally, to extract the full vector</p><pre><code class="language-julia hljs">@show sol[2,:];  # whole second vector</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">11-element Vector{Float64}:
  0.0
 -0.0033055183602664624
 -0.012736109912669335
 -0.00339036759919566
 -0.005784926834562136
  0.006850663589071954
 -0.005516071573007163
 -0.008072679890898023
 -0.005642008936050115
 -0.02810831548040742
 -0.012207124075029649</code></pre><p>The results for all of <code>sol.u</code> can be loaded in a dataframe, where the column names will be the (optionally) provided symbols.</p><pre><code class="language-julia hljs">df = DataFrame(sol)</code></pre><div class="data-frame"><p>11 rows × 3 columns</p><table class="data-frame"><thead><tr><th></th><th>timestamp</th><th>a</th><th>b</th></tr><tr><th></th><th title="Int64">Int64</th><th title="Float64">Float64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>1</td><td>0.0</td><td>-0.00330552</td></tr><tr><th>3</th><td>2</td><td>-0.0204942</td><td>-0.0127361</td></tr><tr><th>4</th><td>3</td><td>-0.0984334</td><td>-0.00339037</td></tr><tr><th>5</th><td>4</td><td>-0.114532</td><td>-0.00578493</td></tr><tr><th>6</th><td>5</td><td>-0.144672</td><td>0.00685066</td></tr><tr><th>7</th><td>6</td><td>-0.0949642</td><td>-0.00551607</td></tr><tr><th>8</th><td>7</td><td>-0.124416</td><td>-0.00807268</td></tr><tr><th>9</th><td>8</td><td>-0.168245</td><td>-0.00564201</td></tr><tr><th>10</th><td>9</td><td>-0.194814</td><td>-0.0281083</td></tr><tr><th>11</th><td>10</td><td>-0.359345</td><td>-0.0122071</td></tr></tbody></table></div><p>Other results, such as the simulated noise and observables can be extracted from the solution</p><pre><code class="language-julia hljs">sol.z # observables</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">11-element Vector{Vector{Float64}}:
 [-0.16021933397233373, -0.21187955742021958]
 [-0.020504868869214918, 0.1428861247848958]
 [-0.23493026438133754, 0.09772140449752242]
 [-0.24289561755021033, 0.023513378026274803]
 [0.08325944393767057, -0.4952711774889442]
 [0.31942512515719057, 0.08875857933304401]
 [-0.09844035118616262, 0.49315126859271696]
 [-0.2019707898798985, -0.18218239046628842]
 [0.01813394711791812, 0.148521178815802]
 [-0.02183406804630602, 0.00970398028240349]
 [0.1059885517878057, -0.13907326043037913]</code></pre><pre><code class="language-julia hljs">sol.W # Simulated Noise</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1×10 Matrix{Float64}:
 -0.330552  -1.2075  -0.0843146  -0.510685  …  -0.402747  -2.69799  -0.658546</code></pre><p>We can also solve the model passing in fixed noise, which will be useful for joint likelihoods.  First lets extract the noise from the previous solution, then rerun the simulation but with a different initial value</p><pre><code class="language-julia hljs">noise = sol.W
u0_2 = [0.1, 0.0]
prob2 = LinearStateSpaceProblem(A, B, u0_2, (0, T); C, observables_noise = D, syms = [:a, :b], noise)
sol2 = solve(prob2)
plot(sol2)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip860">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip860)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip861">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip860)" d="
M86.9921 1505.26 L2352.76 1505.26 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip862">
    <rect x="86" y="47" width="2267" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  540.145,1505.26 540.145,47.2441 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  993.298,1505.26 993.298,47.2441 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1446.45,1505.26 1446.45,47.2441 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1899.6,1505.26 1899.6,47.2441 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2352.76,1505.26 2352.76,47.2441 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,1486.36 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  540.145,1505.26 540.145,1486.36 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  993.298,1505.26 993.298,1486.36 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1446.45,1505.26 1446.45,1486.36 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1899.6,1505.26 1899.6,1486.36 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2352.76,1505.26 2352.76,1486.36 
  "/>
<path clip-path="url(#clip860)" d="M86.9921 1536.18 Q83.381 1536.18 81.5523 1539.74 Q79.7468 1543.28 79.7468 1550.41 Q79.7468 1557.52 81.5523 1561.09 Q83.381 1564.63 86.9921 1564.63 Q90.6264 1564.63 92.4319 1561.09 Q94.2606 1557.52 94.2606 1550.41 Q94.2606 1543.28 92.4319 1539.74 Q90.6264 1536.18 86.9921 1536.18 M86.9921 1532.47 Q92.8023 1532.47 95.8578 1537.08 Q98.9365 1541.66 98.9365 1550.41 Q98.9365 1559.14 95.8578 1563.75 Q92.8023 1568.33 86.9921 1568.33 Q81.182 1568.33 78.1033 1563.75 Q75.0477 1559.14 75.0477 1550.41 Q75.0477 1541.66 78.1033 1537.08 Q81.182 1532.47 86.9921 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M534.798 1563.72 L551.117 1563.72 L551.117 1567.66 L529.173 1567.66 L529.173 1563.72 Q531.835 1560.97 536.418 1556.34 Q541.025 1551.69 542.205 1550.35 Q544.45 1547.82 545.33 1546.09 Q546.233 1544.33 546.233 1542.64 Q546.233 1539.88 544.288 1538.15 Q542.367 1536.41 539.265 1536.41 Q537.066 1536.41 534.613 1537.17 Q532.182 1537.94 529.404 1539.49 L529.404 1534.77 Q532.228 1533.63 534.682 1533.05 Q537.136 1532.47 539.173 1532.47 Q544.543 1532.47 547.737 1535.16 Q550.932 1537.85 550.932 1542.34 Q550.932 1544.47 550.122 1546.39 Q549.335 1548.28 547.228 1550.88 Q546.649 1551.55 543.548 1554.77 Q540.446 1557.96 534.798 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M996.307 1537.17 L984.501 1555.62 L996.307 1555.62 L996.307 1537.17 M995.08 1533.1 L1000.96 1533.1 L1000.96 1555.62 L1005.89 1555.62 L1005.89 1559.51 L1000.96 1559.51 L1000.96 1567.66 L996.307 1567.66 L996.307 1559.51 L980.705 1559.51 L980.705 1555 L995.08 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M1446.86 1548.52 Q1443.71 1548.52 1441.86 1550.67 Q1440.03 1552.82 1440.03 1556.57 Q1440.03 1560.3 1441.86 1562.47 Q1443.71 1564.63 1446.86 1564.63 Q1450 1564.63 1451.83 1562.47 Q1453.68 1560.3 1453.68 1556.57 Q1453.68 1552.82 1451.83 1550.67 Q1450 1548.52 1446.86 1548.52 M1456.14 1533.86 L1456.14 1538.12 Q1454.38 1537.29 1452.57 1536.85 Q1450.79 1536.41 1449.03 1536.41 Q1444.4 1536.41 1441.95 1539.53 Q1439.52 1542.66 1439.17 1548.98 Q1440.54 1546.97 1442.6 1545.9 Q1444.66 1544.81 1447.13 1544.81 Q1452.34 1544.81 1455.35 1547.98 Q1458.38 1551.13 1458.38 1556.57 Q1458.38 1561.9 1455.24 1565.11 Q1452.09 1568.33 1446.86 1568.33 Q1440.86 1568.33 1437.69 1563.75 Q1434.52 1559.14 1434.52 1550.41 Q1434.52 1542.22 1438.41 1537.36 Q1442.3 1532.47 1448.85 1532.47 Q1450.61 1532.47 1452.39 1532.82 Q1454.19 1533.17 1456.14 1533.86 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M1899.6 1551.25 Q1896.27 1551.25 1894.35 1553.03 Q1892.45 1554.81 1892.45 1557.94 Q1892.45 1561.06 1894.35 1562.85 Q1896.27 1564.63 1899.6 1564.63 Q1902.94 1564.63 1904.86 1562.85 Q1906.78 1561.04 1906.78 1557.94 Q1906.78 1554.81 1904.86 1553.03 Q1902.96 1551.25 1899.6 1551.25 M1894.93 1549.26 Q1891.92 1548.52 1890.23 1546.46 Q1888.56 1544.4 1888.56 1541.43 Q1888.56 1537.29 1891.5 1534.88 Q1894.46 1532.47 1899.6 1532.47 Q1904.77 1532.47 1907.7 1534.88 Q1910.64 1537.29 1910.64 1541.43 Q1910.64 1544.4 1908.95 1546.46 Q1907.29 1548.52 1904.3 1549.26 Q1907.68 1550.04 1909.56 1552.34 Q1911.45 1554.63 1911.45 1557.94 Q1911.45 1562.96 1908.38 1565.65 Q1905.32 1568.33 1899.6 1568.33 Q1893.89 1568.33 1890.81 1565.65 Q1887.75 1562.96 1887.75 1557.94 Q1887.75 1554.63 1889.65 1552.34 Q1891.55 1550.04 1894.93 1549.26 M1893.21 1541.87 Q1893.21 1544.56 1894.88 1546.06 Q1896.57 1547.57 1899.6 1547.57 Q1902.61 1547.57 1904.3 1546.06 Q1906.02 1544.56 1906.02 1541.87 Q1906.02 1539.19 1904.3 1537.68 Q1902.61 1536.18 1899.6 1536.18 Q1896.57 1536.18 1894.88 1537.68 Q1893.21 1539.19 1893.21 1541.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M2327.44 1563.72 L2335.08 1563.72 L2335.08 1537.36 L2326.77 1539.03 L2326.77 1534.77 L2335.04 1533.1 L2339.71 1533.1 L2339.71 1563.72 L2347.35 1563.72 L2347.35 1567.66 L2327.44 1567.66 L2327.44 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M2366.8 1536.18 Q2363.18 1536.18 2361.36 1539.74 Q2359.55 1543.28 2359.55 1550.41 Q2359.55 1557.52 2361.36 1561.09 Q2363.18 1564.63 2366.8 1564.63 Q2370.43 1564.63 2372.23 1561.09 Q2374.06 1557.52 2374.06 1550.41 Q2374.06 1543.28 2372.23 1539.74 Q2370.43 1536.18 2366.8 1536.18 M2366.8 1532.47 Q2372.61 1532.47 2375.66 1537.08 Q2378.74 1541.66 2378.74 1550.41 Q2378.74 1559.14 2375.66 1563.75 Q2372.61 1568.33 2366.8 1568.33 Q2360.99 1568.33 2357.91 1563.75 Q2354.85 1559.14 2354.85 1550.41 Q2354.85 1541.66 2357.91 1537.08 Q2360.99 1532.47 2366.8 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M1218.94 1604.35 L1218.94 1614.48 L1231 1614.48 L1231 1619.03 L1218.94 1619.03 L1218.94 1638.38 Q1218.94 1642.74 1220.11 1643.98 Q1221.32 1645.22 1224.98 1645.22 L1231 1645.22 L1231 1650.12 L1224.98 1650.12 Q1218.2 1650.12 1215.62 1647.61 Q1213.05 1645.06 1213.05 1638.38 L1213.05 1619.03 L1208.75 1619.03 L1208.75 1614.48 L1213.05 1614.48 L1213.05 1604.35 L1218.94 1604.35 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1465.82 2352.76,1465.82 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1121.49 2352.76,1121.49 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,777.163 2352.76,777.163 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,432.836 2352.76,432.836 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,88.5087 2352.76,88.5087 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1465.82 105.89,1465.82 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1121.49 105.89,1121.49 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,777.163 105.89,777.163 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,432.836 105.89,432.836 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.5087 105.89,88.5087 
  "/>
<path clip-path="url(#clip860)" d="M-55.3036 1466.27 L-25.6278 1466.27 L-25.6278 1470.2 L-55.3036 1470.2 L-55.3036 1466.27 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-5.53535 1451.62 Q-9.14644 1451.62 -10.9751 1455.18 Q-12.7807 1458.72 -12.7807 1465.85 Q-12.7807 1472.96 -10.9751 1476.52 Q-9.14644 1480.06 -5.53535 1480.06 Q-1.90111 1480.06 -0.0955632 1476.52 Q1.73313 1472.96 1.73313 1465.85 Q1.73313 1458.72 -0.0955632 1455.18 Q-1.90111 1451.62 -5.53535 1451.62 M-5.53535 1447.91 Q0.274805 1447.91 3.33034 1452.52 Q6.40903 1457.1 6.40903 1465.85 Q6.40903 1474.58 3.33034 1479.19 Q0.274805 1483.77 -5.53535 1483.77 Q-11.3455 1483.77 -14.4242 1479.19 Q-17.4797 1474.58 -17.4797 1465.85 Q-17.4797 1457.1 -14.4242 1452.52 Q-11.3455 1447.91 -5.53535 1447.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M14.6266 1477.22 L19.5108 1477.22 L19.5108 1483.1 L14.6266 1483.1 L14.6266 1477.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M43.8625 1464.46 Q47.219 1465.18 49.094 1467.45 Q50.9921 1469.72 50.9921 1473.05 Q50.9921 1478.17 47.4736 1480.97 Q43.9551 1483.77 37.4737 1483.77 Q35.2978 1483.77 32.983 1483.33 Q30.6913 1482.91 28.2376 1482.06 L28.2376 1477.54 Q30.1821 1478.68 32.4969 1479.25 Q34.8117 1479.83 37.3348 1479.83 Q41.7329 1479.83 44.0246 1478.1 Q46.3394 1476.36 46.3394 1473.05 Q46.3394 1470 44.1866 1468.28 Q42.057 1466.55 38.2376 1466.55 L34.2098 1466.55 L34.2098 1462.7 L38.4227 1462.7 Q41.8718 1462.7 43.7005 1461.34 Q45.5292 1459.95 45.5292 1457.36 Q45.5292 1454.69 43.6311 1453.28 Q41.7561 1451.85 38.2376 1451.85 Q36.3163 1451.85 34.1172 1452.26 Q31.9182 1452.68 29.2793 1453.56 L29.2793 1449.39 Q31.9413 1448.65 34.2561 1448.28 Q36.5941 1447.91 38.6542 1447.91 Q43.9783 1447.91 47.0801 1450.34 Q50.1819 1452.75 50.1819 1456.87 Q50.1819 1459.74 48.5384 1461.73 Q46.8949 1463.7 43.8625 1464.46 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-54.3545 1121.94 L-24.6788 1121.94 L-24.6788 1125.88 L-54.3545 1125.88 L-54.3545 1121.94 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-4.58628 1107.29 Q-8.19737 1107.29 -10.0261 1110.85 Q-11.8316 1114.4 -11.8316 1121.52 Q-11.8316 1128.63 -10.0261 1132.2 Q-8.19737 1135.74 -4.58628 1135.74 Q-0.95204 1135.74 0.853506 1132.2 Q2.6822 1128.63 2.6822 1121.52 Q2.6822 1114.4 0.853506 1110.85 Q-0.95204 1107.29 -4.58628 1107.29 M-4.58628 1103.59 Q1.22387 1103.59 4.27941 1108.19 Q7.3581 1112.77 7.3581 1121.52 Q7.3581 1130.25 4.27941 1134.86 Q1.22387 1139.44 -4.58628 1139.44 Q-10.3964 1139.44 -13.4751 1134.86 Q-16.5307 1130.25 -16.5307 1121.52 Q-16.5307 1112.77 -13.4751 1108.19 Q-10.3964 1103.59 -4.58628 1103.59 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M15.5756 1132.89 L20.4599 1132.89 L20.4599 1138.77 L15.5756 1138.77 L15.5756 1132.89 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M34.6728 1134.83 L50.9921 1134.83 L50.9921 1138.77 L29.0478 1138.77 L29.0478 1134.83 Q31.7098 1132.08 36.2931 1127.45 Q40.8996 1122.8 42.0801 1121.46 Q44.3255 1118.93 45.2051 1117.2 Q46.1079 1115.44 46.1079 1113.75 Q46.1079 1110.99 44.1635 1109.26 Q42.2422 1107.52 39.1403 1107.52 Q36.9413 1107.52 34.4876 1108.28 Q32.057 1109.05 29.2793 1110.6 L29.2793 1105.88 Q32.1033 1104.74 34.557 1104.16 Q37.0107 1103.59 39.0477 1103.59 Q44.4181 1103.59 47.6125 1106.27 Q50.8069 1108.96 50.8069 1113.45 Q50.8069 1115.58 49.9968 1117.5 Q49.2097 1119.4 47.1033 1121.99 Q46.5246 1122.66 43.4227 1125.88 Q40.3209 1129.07 34.6728 1134.83 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-54.7249 777.614 L-25.0491 777.614 L-25.0491 781.55 L-54.7249 781.55 L-54.7249 777.614 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-4.95665 762.962 Q-8.56774 762.962 -10.3964 766.526 Q-12.202 770.068 -12.202 777.198 Q-12.202 784.304 -10.3964 787.869 Q-8.56774 791.411 -4.95665 791.411 Q-1.32241 791.411 0.483137 787.869 Q2.31183 784.304 2.31183 777.198 Q2.31183 770.068 0.483137 766.526 Q-1.32241 762.962 -4.95665 762.962 M-4.95665 759.258 Q0.853506 759.258 3.90904 763.864 Q6.98773 768.448 6.98773 777.198 Q6.98773 785.924 3.90904 790.531 Q0.853506 795.114 -4.95665 795.114 Q-10.7668 795.114 -13.8455 790.531 Q-16.901 785.924 -16.901 777.198 Q-16.901 768.448 -13.8455 763.864 Q-10.7668 759.258 -4.95665 759.258 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M15.2053 788.563 L20.0895 788.563 L20.0895 794.443 L15.2053 794.443 L15.2053 788.563 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M31.0848 790.508 L38.7237 790.508 L38.7237 764.142 L30.4135 765.809 L30.4135 761.55 L38.6774 759.883 L43.3533 759.883 L43.3533 790.508 L50.9921 790.508 L50.9921 794.443 L31.0848 794.443 L31.0848 790.508 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-6.18349 418.635 Q-9.79459 418.635 -11.6233 422.199 Q-13.4288 425.741 -13.4288 432.871 Q-13.4288 439.977 -11.6233 443.542 Q-9.79459 447.083 -6.18349 447.083 Q-2.54925 447.083 -0.743708 443.542 Q1.08499 439.977 1.08499 432.871 Q1.08499 425.741 -0.743708 422.199 Q-2.54925 418.635 -6.18349 418.635 M-6.18349 414.931 Q-0.37334 414.931 2.6822 419.537 Q5.76089 424.121 5.76089 432.871 Q5.76089 441.597 2.6822 446.204 Q-0.37334 450.787 -6.18349 450.787 Q-11.9936 450.787 -15.0723 446.204 Q-18.1279 441.597 -18.1279 432.871 Q-18.1279 424.121 -15.0723 419.537 Q-11.9936 414.931 -6.18349 414.931 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M13.9784 444.236 L18.8627 444.236 L18.8627 450.116 L13.9784 450.116 L13.9784 444.236 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M39.0477 418.635 Q35.4367 418.635 33.608 422.199 Q31.8024 425.741 31.8024 432.871 Q31.8024 439.977 33.608 443.542 Q35.4367 447.083 39.0477 447.083 Q42.682 447.083 44.4875 443.542 Q46.3162 439.977 46.3162 432.871 Q46.3162 425.741 44.4875 422.199 Q42.682 418.635 39.0477 418.635 M39.0477 414.931 Q44.8579 414.931 47.9134 419.537 Q50.9921 424.121 50.9921 432.871 Q50.9921 441.597 47.9134 446.204 Q44.8579 450.787 39.0477 450.787 Q33.2376 450.787 30.1589 446.204 Q27.1034 441.597 27.1034 432.871 Q27.1034 424.121 30.1589 419.537 Q33.2376 414.931 39.0477 414.931 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M-4.95665 74.3074 Q-8.56774 74.3074 -10.3964 77.8722 Q-12.202 81.4138 -12.202 88.5434 Q-12.202 95.6499 -10.3964 99.2147 Q-8.56774 102.756 -4.95665 102.756 Q-1.32241 102.756 0.483137 99.2147 Q2.31183 95.6499 2.31183 88.5434 Q2.31183 81.4138 0.483137 77.8722 Q-1.32241 74.3074 -4.95665 74.3074 M-4.95665 70.6037 Q0.853506 70.6037 3.90904 75.2102 Q6.98773 79.7935 6.98773 88.5434 Q6.98773 97.2702 3.90904 101.877 Q0.853506 106.46 -4.95665 106.46 Q-10.7668 106.46 -13.8455 101.877 Q-16.901 97.2702 -16.901 88.5434 Q-16.901 79.7935 -13.8455 75.2102 Q-10.7668 70.6037 -4.95665 70.6037 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M15.2053 99.9091 L20.0895 99.9091 L20.0895 105.789 L15.2053 105.789 L15.2053 99.9091 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip860)" d="M31.0848 101.854 L38.7237 101.854 L38.7237 75.4879 L30.4135 77.1546 L30.4135 72.8953 L38.6774 71.2287 L43.3533 71.2287 L43.3533 101.854 L50.9921 101.854 L50.9921 105.789 L31.0848 105.789 L31.0848 101.854 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip862)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.5087 313.569,105.725 540.145,192.648 766.721,476.551 993.298,546.744 1219.87,664.547 1446.45,506.711 1673.03,620.776 1899.6,783.717 2126.18,886.62 
  2352.76,1464 
  "/>
<polyline clip-path="url(#clip862)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,432.836 313.569,444.218 540.145,476.69 766.721,444.51 993.298,452.755 1219.87,409.247 1446.45,451.829 1673.03,460.632 1899.6,452.263 2126.18,529.62 
  2352.76,474.868 
  "/>
<path clip-path="url(#clip860)" d="
M2002.28 251.365 L2277.23 251.365 L2277.23 95.8446 L2002.28 95.8446  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2002.28,251.365 2277.23,251.365 2277.23,95.8446 2002.28,95.8446 2002.28,251.365 
  "/>
<polyline clip-path="url(#clip860)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,147.685 2178.51,147.685 
  "/>
<path clip-path="url(#clip860)" d="M2217.09 151.932 Q2211.93 151.932 2209.94 153.113 Q2207.95 154.293 2207.95 157.141 Q2207.95 159.409 2209.43 160.752 Q2210.93 162.071 2213.5 162.071 Q2217.04 162.071 2219.17 159.571 Q2221.32 157.048 2221.32 152.881 L2221.32 151.932 L2217.09 151.932 M2225.58 150.173 L2225.58 164.965 L2221.32 164.965 L2221.32 161.029 Q2219.87 163.391 2217.69 164.525 Q2215.51 165.636 2212.37 165.636 Q2208.38 165.636 2206.02 163.414 Q2203.69 161.168 2203.69 157.418 Q2203.69 153.043 2206.6 150.821 Q2209.54 148.599 2215.35 148.599 L2221.32 148.599 L2221.32 148.182 Q2221.32 145.243 2219.38 143.645 Q2217.46 142.025 2213.96 142.025 Q2211.74 142.025 2209.63 142.557 Q2207.53 143.09 2205.58 144.155 L2205.58 140.219 Q2207.92 139.317 2210.12 138.877 Q2212.32 138.414 2214.4 138.414 Q2220.03 138.414 2222.81 141.33 Q2225.58 144.247 2225.58 150.173 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip860)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,199.525 2178.51,199.525 
  "/>
<path clip-path="url(#clip860)" d="M2222.46 203.865 Q2222.46 199.166 2220.51 196.504 Q2218.59 193.819 2215.21 193.819 Q2211.83 193.819 2209.89 196.504 Q2207.97 199.166 2207.97 203.865 Q2207.97 208.564 2209.89 211.249 Q2211.83 213.911 2215.21 213.911 Q2218.59 213.911 2220.51 211.249 Q2222.46 208.564 2222.46 203.865 M2207.97 194.814 Q2209.31 192.499 2211.35 191.388 Q2213.41 190.254 2216.26 190.254 Q2220.98 190.254 2223.92 194.004 Q2226.88 197.754 2226.88 203.865 Q2226.88 209.976 2223.92 213.726 Q2220.98 217.476 2216.26 217.476 Q2213.41 217.476 2211.35 216.365 Q2209.31 215.231 2207.97 212.916 L2207.97 216.805 L2203.69 216.805 L2203.69 180.786 L2207.97 180.786 L2207.97 194.814 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>To construct an IRF we can take the model and perturb just the first element of the noise,</p><pre><code class="language-julia hljs">function irf(A, B, C, T = 20)
    noise = Matrix([1.0; zeros(T-1)]&#39;)
    problem = LinearStateSpaceProblem(A, B, zeros(2), (0, T); C, noise, syms = [:a, :b])
    return solve(problem)
end
plot(irf(A, B, C))</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip920">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip920)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip921">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip920)" d="
M86.9921 1505.26 L2352.76 1505.26 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip922">
    <rect x="86" y="47" width="2267" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  653.433,1505.26 653.433,47.2441 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1219.87,1505.26 1219.87,47.2441 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1786.31,1505.26 1786.31,47.2441 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2352.76,1505.26 2352.76,47.2441 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,1486.36 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  653.433,1505.26 653.433,1486.36 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1219.87,1505.26 1219.87,1486.36 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1786.31,1505.26 1786.31,1486.36 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2352.76,1505.26 2352.76,1486.36 
  "/>
<path clip-path="url(#clip920)" d="M86.9921 1536.18 Q83.381 1536.18 81.5523 1539.74 Q79.7468 1543.28 79.7468 1550.41 Q79.7468 1557.52 81.5523 1561.09 Q83.381 1564.63 86.9921 1564.63 Q90.6264 1564.63 92.4319 1561.09 Q94.2606 1557.52 94.2606 1550.41 Q94.2606 1543.28 92.4319 1539.74 Q90.6264 1536.18 86.9921 1536.18 M86.9921 1532.47 Q92.8023 1532.47 95.8578 1537.08 Q98.9365 1541.66 98.9365 1550.41 Q98.9365 1559.14 95.8578 1563.75 Q92.8023 1568.33 86.9921 1568.33 Q81.182 1568.33 78.1033 1563.75 Q75.0477 1559.14 75.0477 1550.41 Q75.0477 1541.66 78.1033 1537.08 Q81.182 1532.47 86.9921 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M643.711 1533.1 L662.067 1533.1 L662.067 1537.04 L647.993 1537.04 L647.993 1545.51 Q649.012 1545.16 650.03 1545 Q651.049 1544.81 652.067 1544.81 Q657.854 1544.81 661.234 1547.98 Q664.614 1551.16 664.614 1556.57 Q664.614 1562.15 661.141 1565.25 Q657.669 1568.33 651.35 1568.33 Q649.174 1568.33 646.905 1567.96 Q644.66 1567.59 642.253 1566.85 L642.253 1562.15 Q644.336 1563.28 646.558 1563.84 Q648.78 1564.4 651.257 1564.4 Q655.262 1564.4 657.6 1562.29 Q659.938 1560.18 659.938 1556.57 Q659.938 1552.96 657.6 1550.85 Q655.262 1548.75 651.257 1548.75 Q649.382 1548.75 647.507 1549.16 Q645.655 1549.58 643.711 1550.46 L643.711 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M1194.56 1563.72 L1202.2 1563.72 L1202.2 1537.36 L1193.89 1539.03 L1193.89 1534.77 L1202.15 1533.1 L1206.83 1533.1 L1206.83 1563.72 L1214.47 1563.72 L1214.47 1567.66 L1194.56 1567.66 L1194.56 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M1233.91 1536.18 Q1230.3 1536.18 1228.47 1539.74 Q1226.67 1543.28 1226.67 1550.41 Q1226.67 1557.52 1228.47 1561.09 Q1230.3 1564.63 1233.91 1564.63 Q1237.55 1564.63 1239.35 1561.09 Q1241.18 1557.52 1241.18 1550.41 Q1241.18 1543.28 1239.35 1539.74 Q1237.55 1536.18 1233.91 1536.18 M1233.91 1532.47 Q1239.72 1532.47 1242.78 1537.08 Q1245.86 1541.66 1245.86 1550.41 Q1245.86 1559.14 1242.78 1563.75 Q1239.72 1568.33 1233.91 1568.33 Q1228.1 1568.33 1225.02 1563.75 Q1221.97 1559.14 1221.97 1550.41 Q1221.97 1541.66 1225.02 1537.08 Q1228.1 1532.47 1233.91 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M1761.5 1563.72 L1769.14 1563.72 L1769.14 1537.36 L1760.83 1539.03 L1760.83 1534.77 L1769.09 1533.1 L1773.77 1533.1 L1773.77 1563.72 L1781.41 1563.72 L1781.41 1567.66 L1761.5 1567.66 L1761.5 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M1790.9 1533.1 L1809.25 1533.1 L1809.25 1537.04 L1795.18 1537.04 L1795.18 1545.51 Q1796.2 1545.16 1797.22 1545 Q1798.24 1544.81 1799.25 1544.81 Q1805.04 1544.81 1808.42 1547.98 Q1811.8 1551.16 1811.8 1556.57 Q1811.8 1562.15 1808.33 1565.25 Q1804.86 1568.33 1798.54 1568.33 Q1796.36 1568.33 1794.09 1567.96 Q1791.85 1567.59 1789.44 1566.85 L1789.44 1562.15 Q1791.52 1563.28 1793.75 1563.84 Q1795.97 1564.4 1798.44 1564.4 Q1802.45 1564.4 1804.79 1562.29 Q1807.13 1560.18 1807.13 1556.57 Q1807.13 1552.96 1804.79 1550.85 Q1802.45 1548.75 1798.44 1548.75 Q1796.57 1548.75 1794.69 1549.16 Q1792.84 1549.58 1790.9 1550.46 L1790.9 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M2331.53 1563.72 L2347.85 1563.72 L2347.85 1567.66 L2325.9 1567.66 L2325.9 1563.72 Q2328.57 1560.97 2333.15 1556.34 Q2337.76 1551.69 2338.94 1550.35 Q2341.18 1547.82 2342.06 1546.09 Q2342.96 1544.33 2342.96 1542.64 Q2342.96 1539.88 2341.02 1538.15 Q2339.1 1536.41 2336 1536.41 Q2333.8 1536.41 2331.34 1537.17 Q2328.91 1537.94 2326.14 1539.49 L2326.14 1534.77 Q2328.96 1533.63 2331.41 1533.05 Q2333.87 1532.47 2335.9 1532.47 Q2341.27 1532.47 2344.47 1535.16 Q2347.66 1537.85 2347.66 1542.34 Q2347.66 1544.47 2346.85 1546.39 Q2346.07 1548.28 2343.96 1550.88 Q2343.38 1551.55 2340.28 1554.77 Q2337.18 1557.96 2331.53 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M2367.66 1536.18 Q2364.05 1536.18 2362.22 1539.74 Q2360.42 1543.28 2360.42 1550.41 Q2360.42 1557.52 2362.22 1561.09 Q2364.05 1564.63 2367.66 1564.63 Q2371.3 1564.63 2373.1 1561.09 Q2374.93 1557.52 2374.93 1550.41 Q2374.93 1543.28 2373.1 1539.74 Q2371.3 1536.18 2367.66 1536.18 M2367.66 1532.47 Q2373.47 1532.47 2376.53 1537.08 Q2379.61 1541.66 2379.61 1550.41 Q2379.61 1559.14 2376.53 1563.75 Q2373.47 1568.33 2367.66 1568.33 Q2361.85 1568.33 2358.77 1563.75 Q2355.72 1559.14 2355.72 1550.41 Q2355.72 1541.66 2358.77 1537.08 Q2361.85 1532.47 2367.66 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M1218.94 1604.35 L1218.94 1614.48 L1231 1614.48 L1231 1619.03 L1218.94 1619.03 L1218.94 1638.38 Q1218.94 1642.74 1220.11 1643.98 Q1221.32 1645.22 1224.98 1645.22 L1231 1645.22 L1231 1650.12 L1224.98 1650.12 Q1218.2 1650.12 1215.62 1647.61 Q1213.05 1645.06 1213.05 1638.38 L1213.05 1619.03 L1208.75 1619.03 L1208.75 1614.48 L1213.05 1614.48 L1213.05 1604.35 L1218.94 1604.35 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1464 2352.76,1464 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1078.16 2352.76,1078.16 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,692.334 2352.76,692.334 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,306.503 2352.76,306.503 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1464 105.89,1464 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1078.16 105.89,1078.16 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,692.334 105.89,692.334 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,306.503 105.89,306.503 
  "/>
<path clip-path="url(#clip920)" d="M-36.3454 1449.79 Q-39.9565 1449.79 -41.7852 1453.36 Q-43.5907 1456.9 -43.5907 1464.03 Q-43.5907 1471.14 -41.7852 1474.7 Q-39.9565 1478.24 -36.3454 1478.24 Q-32.7111 1478.24 -30.9056 1474.7 Q-29.0769 1471.14 -29.0769 1464.03 Q-29.0769 1456.9 -30.9056 1453.36 Q-32.7111 1449.79 -36.3454 1449.79 M-36.3454 1446.09 Q-30.5352 1446.09 -27.4797 1450.7 Q-24.401 1455.28 -24.401 1464.03 Q-24.401 1472.76 -27.4797 1477.36 Q-30.5352 1481.95 -36.3454 1481.95 Q-42.1555 1481.95 -45.2342 1477.36 Q-48.2897 1472.76 -48.2897 1464.03 Q-48.2897 1455.28 -45.2342 1450.7 Q-42.1555 1446.09 -36.3454 1446.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-16.1834 1475.4 L-11.2992 1475.4 L-11.2992 1481.28 L-16.1834 1481.28 L-16.1834 1475.4 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M8.88587 1449.79 Q5.27478 1449.79 3.44608 1453.36 Q1.64054 1456.9 1.64054 1464.03 Q1.64054 1471.14 3.44608 1474.7 Q5.27478 1478.24 8.88587 1478.24 Q12.5201 1478.24 14.3257 1474.7 Q16.1543 1471.14 16.1543 1464.03 Q16.1543 1456.9 14.3257 1453.36 Q12.5201 1449.79 8.88587 1449.79 M8.88587 1446.09 Q14.696 1446.09 17.7516 1450.7 Q20.8303 1455.28 20.8303 1464.03 Q20.8303 1472.76 17.7516 1477.36 Q14.696 1481.95 8.88587 1481.95 Q3.07572 1481.95 -0.00297114 1477.36 Q-3.05851 1472.76 -3.05851 1464.03 Q-3.05851 1455.28 -0.00297114 1450.7 Q3.07572 1446.09 8.88587 1446.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M39.0477 1449.79 Q35.4367 1449.79 33.608 1453.36 Q31.8024 1456.9 31.8024 1464.03 Q31.8024 1471.14 33.608 1474.7 Q35.4367 1478.24 39.0477 1478.24 Q42.682 1478.24 44.4875 1474.7 Q46.3162 1471.14 46.3162 1464.03 Q46.3162 1456.9 44.4875 1453.36 Q42.682 1449.79 39.0477 1449.79 M39.0477 1446.09 Q44.8579 1446.09 47.9134 1450.7 Q50.9921 1455.28 50.9921 1464.03 Q50.9921 1472.76 47.9134 1477.36 Q44.8579 1481.95 39.0477 1481.95 Q33.2376 1481.95 30.1589 1477.36 Q27.1034 1472.76 27.1034 1464.03 Q27.1034 1455.28 30.1589 1450.7 Q33.2376 1446.09 39.0477 1446.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-34.7482 1063.96 Q-38.3592 1063.96 -40.1879 1067.53 Q-41.9935 1071.07 -41.9935 1078.2 Q-41.9935 1085.31 -40.1879 1088.87 Q-38.3592 1092.41 -34.7482 1092.41 Q-31.1139 1092.41 -29.3084 1088.87 Q-27.4797 1085.31 -27.4797 1078.2 Q-27.4797 1071.07 -29.3084 1067.53 Q-31.1139 1063.96 -34.7482 1063.96 M-34.7482 1060.26 Q-28.938 1060.26 -25.8825 1064.87 Q-22.8038 1069.45 -22.8038 1078.2 Q-22.8038 1086.93 -25.8825 1091.53 Q-28.938 1096.12 -34.7482 1096.12 Q-40.5583 1096.12 -43.637 1091.53 Q-46.6925 1086.93 -46.6925 1078.2 Q-46.6925 1069.45 -43.637 1064.87 Q-40.5583 1060.26 -34.7482 1060.26 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-14.5862 1089.56 L-9.70199 1089.56 L-9.70199 1095.44 L-14.5862 1095.44 L-14.5862 1089.56 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M10.4831 1063.96 Q6.87199 1063.96 5.0433 1067.53 Q3.23775 1071.07 3.23775 1078.2 Q3.23775 1085.31 5.0433 1088.87 Q6.87199 1092.41 10.4831 1092.41 Q14.1173 1092.41 15.9229 1088.87 Q17.7516 1085.31 17.7516 1078.2 Q17.7516 1071.07 15.9229 1067.53 Q14.1173 1063.96 10.4831 1063.96 M10.4831 1060.26 Q16.2932 1060.26 19.3488 1064.87 Q22.4275 1069.45 22.4275 1078.2 Q22.4275 1086.93 19.3488 1091.53 Q16.2932 1096.12 10.4831 1096.12 Q4.67293 1096.12 1.59424 1091.53 Q-1.4613 1086.93 -1.4613 1078.2 Q-1.4613 1069.45 1.59424 1064.87 Q4.67293 1060.26 10.4831 1060.26 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M34.6728 1091.51 L50.9921 1091.51 L50.9921 1095.44 L29.0478 1095.44 L29.0478 1091.51 Q31.7098 1088.75 36.2931 1084.13 Q40.8996 1079.47 42.0801 1078.13 Q44.3255 1075.61 45.2051 1073.87 Q46.1079 1072.11 46.1079 1070.42 Q46.1079 1067.67 44.1635 1065.93 Q42.2422 1064.19 39.1403 1064.19 Q36.9413 1064.19 34.4876 1064.96 Q32.057 1065.72 29.2793 1067.27 L29.2793 1062.55 Q32.1033 1061.42 34.557 1060.84 Q37.0107 1060.26 39.0477 1060.26 Q44.4181 1060.26 47.6125 1062.94 Q50.8069 1065.63 50.8069 1070.12 Q50.8069 1072.25 49.9968 1074.17 Q49.2097 1076.07 47.1033 1078.66 Q46.5246 1079.33 43.4227 1082.55 Q40.3209 1085.75 34.6728 1091.51 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-36.8315 678.132 Q-40.4426 678.132 -42.2713 681.697 Q-44.0768 685.239 -44.0768 692.369 Q-44.0768 699.475 -42.2713 703.04 Q-40.4426 706.581 -36.8315 706.581 Q-33.1972 706.581 -31.3917 703.04 Q-29.563 699.475 -29.563 692.369 Q-29.563 685.239 -31.3917 681.697 Q-33.1972 678.132 -36.8315 678.132 M-36.8315 674.429 Q-31.0213 674.429 -27.9658 679.035 Q-24.8871 683.619 -24.8871 692.369 Q-24.8871 701.095 -27.9658 705.702 Q-31.0213 710.285 -36.8315 710.285 Q-42.6416 710.285 -45.7203 705.702 Q-48.7759 701.095 -48.7759 692.369 Q-48.7759 683.619 -45.7203 679.035 Q-42.6416 674.429 -36.8315 674.429 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-16.6695 703.734 L-11.7853 703.734 L-11.7853 709.614 L-16.6695 709.614 L-16.6695 703.734 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M8.39976 678.132 Q4.78867 678.132 2.95998 681.697 Q1.15443 685.239 1.15443 692.369 Q1.15443 699.475 2.95998 703.04 Q4.78867 706.581 8.39976 706.581 Q12.034 706.581 13.8395 703.04 Q15.6682 699.475 15.6682 692.369 Q15.6682 685.239 13.8395 681.697 Q12.034 678.132 8.39976 678.132 M8.39976 674.429 Q14.2099 674.429 17.2655 679.035 Q20.3441 683.619 20.3441 692.369 Q20.3441 701.095 17.2655 705.702 Q14.2099 710.285 8.39976 710.285 Q2.58961 710.285 -0.48908 705.702 Q-3.54462 701.095 -3.54462 692.369 Q-3.54462 683.619 -0.48908 679.035 Q2.58961 674.429 8.39976 674.429 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M41.4088 679.128 L29.6034 697.577 L41.4088 697.577 L41.4088 679.128 M40.182 675.054 L46.0616 675.054 L46.0616 697.577 L50.9921 697.577 L50.9921 701.466 L46.0616 701.466 L46.0616 709.614 L41.4088 709.614 L41.4088 701.466 L25.8071 701.466 L25.8071 696.952 L40.182 675.054 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-36.5074 292.302 Q-40.1185 292.302 -41.9472 295.867 Q-43.7527 299.408 -43.7527 306.538 Q-43.7527 313.644 -41.9472 317.209 Q-40.1185 320.751 -36.5074 320.751 Q-32.8732 320.751 -31.0676 317.209 Q-29.2389 313.644 -29.2389 306.538 Q-29.2389 299.408 -31.0676 295.867 Q-32.8732 292.302 -36.5074 292.302 M-36.5074 288.598 Q-30.6973 288.598 -27.6417 293.205 Q-24.563 297.788 -24.563 306.538 Q-24.563 315.265 -27.6417 319.871 Q-30.6973 324.454 -36.5074 324.454 Q-42.3176 324.454 -45.3962 319.871 Q-48.4518 315.265 -48.4518 306.538 Q-48.4518 297.788 -45.3962 293.205 Q-42.3176 288.598 -36.5074 288.598 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M-16.3455 317.903 L-11.4612 317.903 L-11.4612 323.783 L-16.3455 323.783 L-16.3455 317.903 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M8.72383 292.302 Q5.11274 292.302 3.28405 295.867 Q1.4785 299.408 1.4785 306.538 Q1.4785 313.644 3.28405 317.209 Q5.11274 320.751 8.72383 320.751 Q12.3581 320.751 14.1636 317.209 Q15.9923 313.644 15.9923 306.538 Q15.9923 299.408 14.1636 295.867 Q12.3581 292.302 8.72383 292.302 M8.72383 288.598 Q14.534 288.598 17.5895 293.205 Q20.6682 297.788 20.6682 306.538 Q20.6682 315.265 17.5895 319.871 Q14.534 324.454 8.72383 324.454 Q2.91368 324.454 -0.165007 319.871 Q-3.22055 315.265 -3.22055 306.538 Q-3.22055 297.788 -0.165007 293.205 Q2.91368 288.598 8.72383 288.598 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip920)" d="M39.4644 304.64 Q36.3163 304.64 34.4644 306.792 Q32.6357 308.945 32.6357 312.695 Q32.6357 316.422 34.4644 318.598 Q36.3163 320.751 39.4644 320.751 Q42.6125 320.751 44.4412 318.598 Q46.2931 316.422 46.2931 312.695 Q46.2931 308.945 44.4412 306.792 Q42.6125 304.64 39.4644 304.64 M48.7468 289.987 L48.7468 294.246 Q46.9875 293.413 45.182 292.973 Q43.3996 292.533 41.6403 292.533 Q37.0107 292.533 34.557 295.658 Q32.1265 298.783 31.7793 305.103 Q33.145 303.089 35.2052 302.024 Q37.2653 300.936 39.7422 300.936 Q44.9505 300.936 47.9597 304.107 Q50.9921 307.255 50.9921 312.695 Q50.9921 318.019 47.844 321.237 Q44.6959 324.454 39.4644 324.454 Q33.4691 324.454 30.2978 319.871 Q27.1265 315.265 27.1265 306.538 Q27.1265 298.343 31.0154 293.482 Q34.9042 288.598 41.4551 288.598 Q43.2144 288.598 44.9968 288.945 Q46.8023 289.292 48.7468 289.987 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip922)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1464 200.28,1464 313.569,267.92 426.857,88.5087 540.145,109.44 653.433,167.599 766.721,230.505 880.009,291.797 993.298,350.33 1106.59,405.998 
  1219.87,458.895 1333.16,509.149 1446.45,556.892 1559.74,602.247 1673.03,645.334 1786.31,686.267 1899.6,725.154 2012.89,762.096 2126.18,797.191 2239.47,830.531 
  2352.76,862.204 
  "/>
<polyline clip-path="url(#clip922)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1464 200.28,1271.08 313.569,1425.41 426.857,1456.28 540.145,1462.45 653.433,1463.69 766.721,1463.93 880.009,1463.98 993.298,1463.99 1106.59,1463.99 
  1219.87,1464 1333.16,1464 1446.45,1464 1559.74,1464 1673.03,1464 1786.31,1464 1899.6,1464 2012.89,1464 2126.18,1464 2239.47,1464 
  2352.76,1464 
  "/>
<path clip-path="url(#clip920)" d="
M2002.28 251.365 L2277.23 251.365 L2277.23 95.8446 L2002.28 95.8446  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2002.28,251.365 2277.23,251.365 2277.23,95.8446 2002.28,95.8446 2002.28,251.365 
  "/>
<polyline clip-path="url(#clip920)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,147.685 2178.51,147.685 
  "/>
<path clip-path="url(#clip920)" d="M2217.09 151.932 Q2211.93 151.932 2209.94 153.113 Q2207.95 154.293 2207.95 157.141 Q2207.95 159.409 2209.43 160.752 Q2210.93 162.071 2213.5 162.071 Q2217.04 162.071 2219.17 159.571 Q2221.32 157.048 2221.32 152.881 L2221.32 151.932 L2217.09 151.932 M2225.58 150.173 L2225.58 164.965 L2221.32 164.965 L2221.32 161.029 Q2219.87 163.391 2217.69 164.525 Q2215.51 165.636 2212.37 165.636 Q2208.38 165.636 2206.02 163.414 Q2203.69 161.168 2203.69 157.418 Q2203.69 153.043 2206.6 150.821 Q2209.54 148.599 2215.35 148.599 L2221.32 148.599 L2221.32 148.182 Q2221.32 145.243 2219.38 143.645 Q2217.46 142.025 2213.96 142.025 Q2211.74 142.025 2209.63 142.557 Q2207.53 143.09 2205.58 144.155 L2205.58 140.219 Q2207.92 139.317 2210.12 138.877 Q2212.32 138.414 2214.4 138.414 Q2220.03 138.414 2222.81 141.33 Q2225.58 144.247 2225.58 150.173 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip920)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.46,199.525 2178.51,199.525 
  "/>
<path clip-path="url(#clip920)" d="M2222.46 203.865 Q2222.46 199.166 2220.51 196.504 Q2218.59 193.819 2215.21 193.819 Q2211.83 193.819 2209.89 196.504 Q2207.97 199.166 2207.97 203.865 Q2207.97 208.564 2209.89 211.249 Q2211.83 213.911 2215.21 213.911 Q2218.59 213.911 2220.51 211.249 Q2222.46 208.564 2222.46 203.865 M2207.97 194.814 Q2209.31 192.499 2211.35 191.388 Q2213.41 190.254 2216.26 190.254 Q2220.98 190.254 2223.92 194.004 Q2226.88 197.754 2226.88 203.865 Q2226.88 209.976 2223.92 213.726 Q2220.98 217.476 2216.26 217.476 Q2213.41 217.476 2211.35 216.365 Q2209.31 215.231 2207.97 212.916 L2207.97 216.805 L2203.69 216.805 L2203.69 180.786 L2207.97 180.786 L2207.97 194.814 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>Lets find the 2nd observable at the end of the IRF.</p><pre><code class="language-julia hljs">function last_observable_irf(A, B, C)
    sol = irf(A, B, C)
    return sol.z[end][2]  # return 2nd argument of last observable
end
last_observable_irf(A, B, C)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.03119456447624772</code></pre><p>But everything in this package is differentiable.  Lets differentiate the observable of the IRF with respect to all of the parameters using <code>Zygote.jl</code>,</p><pre><code class="language-julia hljs">gradient(last_observable_irf, A, B, C)  # calculates gradient wrt all arguments</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([0.5822985368900442 0.0050313813671367304; 4.469834483178462 0.041592752634585235], [0.37735360253530714; 3.119456447624773;;], [0.0 0.0; 0.03119456447624772 5.242880000000006e-16])</code></pre><p>Gradients of other model elements (e.g. <code>.u</code> are also possible.  With this in mind, lets find the gradient of the mean of the 1st element of the IRF of the solution with respect to a particular noise vector.</p><pre><code class="language-julia hljs">function mean_u_1(A, B, C, noise, u0, T)
    problem = LinearStateSpaceProblem(A, B, u0, (0, T); noise, syms = [:a, :b])
    sol = solve(problem)
    u = sol.u # see issue #75 workaround
    # can have nontrivial functions and even non-mutating loops
    return mean( u[i][1] for i in 1:T)
end
u0 = [0.0, 0.0]
noise = sol.W # from simulation above
mean_u_1(A, B, C, noise, u0, T)
# dropping a few arguments from derivative
gradient((noise, u0)-&gt; mean_u_1(A, B, C, noise, u0, T), noise, u0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([0.05079876954953124 0.045314515146875 … 0.0 0.0], [0.702526121523242, 5.600882710405467])</code></pre><h2 id="Simulating-Ensembles-and-Fixing-Noise"><a class="docs-heading-anchor" href="#Simulating-Ensembles-and-Fixing-Noise">Simulating Ensembles and Fixing Noise</a><a id="Simulating-Ensembles-and-Fixing-Noise-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-Ensembles-and-Fixing-Noise" title="Permalink"></a></h2><p>If you pass in a distribution for the initial condition, it will draw an initial condition.  Below we will simulate from a deterministic evolution equation and without any observation noise.</p><pre><code class="language-julia hljs">using Distributions, DiffEqBase
u0 = MvNormal([1.0 0.1; 0.1 1.0])  # mean zero initial conditions
prob = LinearStateSpaceProblem(A, nothing, u0, (0, T); C)
sol = solve(prob)
plot(sol)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip980">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip980)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip981">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip980)" d="
M86.9921 1505.26 L2352.76 1505.26 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip982">
    <rect x="86" y="47" width="2267" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  540.145,1505.26 540.145,47.2441 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  993.298,1505.26 993.298,47.2441 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1446.45,1505.26 1446.45,47.2441 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1899.6,1505.26 1899.6,47.2441 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2352.76,1505.26 2352.76,47.2441 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,1486.36 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  540.145,1505.26 540.145,1486.36 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  993.298,1505.26 993.298,1486.36 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1446.45,1505.26 1446.45,1486.36 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1899.6,1505.26 1899.6,1486.36 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2352.76,1505.26 2352.76,1486.36 
  "/>
<path clip-path="url(#clip980)" d="M86.9921 1536.18 Q83.381 1536.18 81.5523 1539.74 Q79.7468 1543.28 79.7468 1550.41 Q79.7468 1557.52 81.5523 1561.09 Q83.381 1564.63 86.9921 1564.63 Q90.6264 1564.63 92.4319 1561.09 Q94.2606 1557.52 94.2606 1550.41 Q94.2606 1543.28 92.4319 1539.74 Q90.6264 1536.18 86.9921 1536.18 M86.9921 1532.47 Q92.8023 1532.47 95.8578 1537.08 Q98.9365 1541.66 98.9365 1550.41 Q98.9365 1559.14 95.8578 1563.75 Q92.8023 1568.33 86.9921 1568.33 Q81.182 1568.33 78.1033 1563.75 Q75.0477 1559.14 75.0477 1550.41 Q75.0477 1541.66 78.1033 1537.08 Q81.182 1532.47 86.9921 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M534.798 1563.72 L551.117 1563.72 L551.117 1567.66 L529.173 1567.66 L529.173 1563.72 Q531.835 1560.97 536.418 1556.34 Q541.025 1551.69 542.205 1550.35 Q544.45 1547.82 545.33 1546.09 Q546.233 1544.33 546.233 1542.64 Q546.233 1539.88 544.288 1538.15 Q542.367 1536.41 539.265 1536.41 Q537.066 1536.41 534.613 1537.17 Q532.182 1537.94 529.404 1539.49 L529.404 1534.77 Q532.228 1533.63 534.682 1533.05 Q537.136 1532.47 539.173 1532.47 Q544.543 1532.47 547.737 1535.16 Q550.932 1537.85 550.932 1542.34 Q550.932 1544.47 550.122 1546.39 Q549.335 1548.28 547.228 1550.88 Q546.649 1551.55 543.548 1554.77 Q540.446 1557.96 534.798 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M996.307 1537.17 L984.501 1555.62 L996.307 1555.62 L996.307 1537.17 M995.08 1533.1 L1000.96 1533.1 L1000.96 1555.62 L1005.89 1555.62 L1005.89 1559.51 L1000.96 1559.51 L1000.96 1567.66 L996.307 1567.66 L996.307 1559.51 L980.705 1559.51 L980.705 1555 L995.08 1533.1 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M1446.86 1548.52 Q1443.71 1548.52 1441.86 1550.67 Q1440.03 1552.82 1440.03 1556.57 Q1440.03 1560.3 1441.86 1562.47 Q1443.71 1564.63 1446.86 1564.63 Q1450 1564.63 1451.83 1562.47 Q1453.68 1560.3 1453.68 1556.57 Q1453.68 1552.82 1451.83 1550.67 Q1450 1548.52 1446.86 1548.52 M1456.14 1533.86 L1456.14 1538.12 Q1454.38 1537.29 1452.57 1536.85 Q1450.79 1536.41 1449.03 1536.41 Q1444.4 1536.41 1441.95 1539.53 Q1439.52 1542.66 1439.17 1548.98 Q1440.54 1546.97 1442.6 1545.9 Q1444.66 1544.81 1447.13 1544.81 Q1452.34 1544.81 1455.35 1547.98 Q1458.38 1551.13 1458.38 1556.57 Q1458.38 1561.9 1455.24 1565.11 Q1452.09 1568.33 1446.86 1568.33 Q1440.86 1568.33 1437.69 1563.75 Q1434.52 1559.14 1434.52 1550.41 Q1434.52 1542.22 1438.41 1537.36 Q1442.3 1532.47 1448.85 1532.47 Q1450.61 1532.47 1452.39 1532.82 Q1454.19 1533.17 1456.14 1533.86 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M1899.6 1551.25 Q1896.27 1551.25 1894.35 1553.03 Q1892.45 1554.81 1892.45 1557.94 Q1892.45 1561.06 1894.35 1562.85 Q1896.27 1564.63 1899.6 1564.63 Q1902.94 1564.63 1904.86 1562.85 Q1906.78 1561.04 1906.78 1557.94 Q1906.78 1554.81 1904.86 1553.03 Q1902.96 1551.25 1899.6 1551.25 M1894.93 1549.26 Q1891.92 1548.52 1890.23 1546.46 Q1888.56 1544.4 1888.56 1541.43 Q1888.56 1537.29 1891.5 1534.88 Q1894.46 1532.47 1899.6 1532.47 Q1904.77 1532.47 1907.7 1534.88 Q1910.64 1537.29 1910.64 1541.43 Q1910.64 1544.4 1908.95 1546.46 Q1907.29 1548.52 1904.3 1549.26 Q1907.68 1550.04 1909.56 1552.34 Q1911.45 1554.63 1911.45 1557.94 Q1911.45 1562.96 1908.38 1565.65 Q1905.32 1568.33 1899.6 1568.33 Q1893.89 1568.33 1890.81 1565.65 Q1887.75 1562.96 1887.75 1557.94 Q1887.75 1554.63 1889.65 1552.34 Q1891.55 1550.04 1894.93 1549.26 M1893.21 1541.87 Q1893.21 1544.56 1894.88 1546.06 Q1896.57 1547.57 1899.6 1547.57 Q1902.61 1547.57 1904.3 1546.06 Q1906.02 1544.56 1906.02 1541.87 Q1906.02 1539.19 1904.3 1537.68 Q1902.61 1536.18 1899.6 1536.18 Q1896.57 1536.18 1894.88 1537.68 Q1893.21 1539.19 1893.21 1541.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2327.44 1563.72 L2335.08 1563.72 L2335.08 1537.36 L2326.77 1539.03 L2326.77 1534.77 L2335.04 1533.1 L2339.71 1533.1 L2339.71 1563.72 L2347.35 1563.72 L2347.35 1567.66 L2327.44 1567.66 L2327.44 1563.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2366.8 1536.18 Q2363.18 1536.18 2361.36 1539.74 Q2359.55 1543.28 2359.55 1550.41 Q2359.55 1557.52 2361.36 1561.09 Q2363.18 1564.63 2366.8 1564.63 Q2370.43 1564.63 2372.23 1561.09 Q2374.06 1557.52 2374.06 1550.41 Q2374.06 1543.28 2372.23 1539.74 Q2370.43 1536.18 2366.8 1536.18 M2366.8 1532.47 Q2372.61 1532.47 2375.66 1537.08 Q2378.74 1541.66 2378.74 1550.41 Q2378.74 1559.14 2375.66 1563.75 Q2372.61 1568.33 2366.8 1568.33 Q2360.99 1568.33 2357.91 1563.75 Q2354.85 1559.14 2354.85 1550.41 Q2354.85 1541.66 2357.91 1537.08 Q2360.99 1532.47 2366.8 1532.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M1218.94 1604.35 L1218.94 1614.48 L1231 1614.48 L1231 1619.03 L1218.94 1619.03 L1218.94 1638.38 Q1218.94 1642.74 1220.11 1643.98 Q1221.32 1645.22 1224.98 1645.22 L1231 1645.22 L1231 1650.12 L1224.98 1650.12 Q1218.2 1650.12 1215.62 1647.61 Q1213.05 1645.06 1213.05 1638.38 L1213.05 1619.03 L1208.75 1619.03 L1208.75 1614.48 L1213.05 1614.48 L1213.05 1604.35 L1218.94 1604.35 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1344.26 2352.76,1344.26 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1052.04 2352.76,1052.04 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,759.825 2352.76,759.825 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,467.607 2352.76,467.607 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,175.389 2352.76,175.389 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1505.26 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1344.26 105.89,1344.26 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1052.04 105.89,1052.04 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,759.825 105.89,759.825 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,467.607 105.89,467.607 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,175.389 105.89,175.389 
  "/>
<path clip-path="url(#clip980)" d="M-10.6279 1344.71 L19.0479 1344.71 L19.0479 1348.65 L-10.6279 1348.65 L-10.6279 1344.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M39.1403 1345.13 Q35.807 1345.13 33.8857 1346.91 Q31.9876 1348.69 31.9876 1351.82 Q31.9876 1354.94 33.8857 1356.73 Q35.807 1358.51 39.1403 1358.51 Q42.4737 1358.51 44.3949 1356.73 Q46.3162 1354.92 46.3162 1351.82 Q46.3162 1348.69 44.3949 1346.91 Q42.4968 1345.13 39.1403 1345.13 M34.4644 1343.14 Q31.4552 1342.4 29.7654 1340.34 Q28.0987 1338.28 28.0987 1335.31 Q28.0987 1331.17 31.0385 1328.76 Q34.0015 1326.36 39.1403 1326.36 Q44.3023 1326.36 47.2421 1328.76 Q50.1819 1331.17 50.1819 1335.31 Q50.1819 1338.28 48.4921 1340.34 Q46.8255 1342.4 43.8394 1343.14 Q47.219 1343.93 49.094 1346.22 Q50.9921 1348.51 50.9921 1351.82 Q50.9921 1356.84 47.9134 1359.53 Q44.8579 1362.21 39.1403 1362.21 Q33.4228 1362.21 30.3441 1359.53 Q27.2885 1356.84 27.2885 1351.82 Q27.2885 1348.51 29.1867 1346.22 Q31.0848 1343.93 34.4644 1343.14 M32.7515 1335.75 Q32.7515 1338.44 34.4181 1339.94 Q36.1079 1341.45 39.1403 1341.45 Q42.1496 1341.45 43.8394 1339.94 Q45.5523 1338.44 45.5523 1335.75 Q45.5523 1333.07 43.8394 1331.56 Q42.1496 1330.06 39.1403 1330.06 Q36.1079 1330.06 34.4181 1331.56 Q32.7515 1333.07 32.7515 1335.75 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M-10.8825 1052.49 L18.7932 1052.49 L18.7932 1056.43 L-10.8825 1056.43 L-10.8825 1052.49 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M39.4644 1050.18 Q36.3163 1050.18 34.4644 1052.33 Q32.6357 1054.49 32.6357 1058.24 Q32.6357 1061.96 34.4644 1064.14 Q36.3163 1066.29 39.4644 1066.29 Q42.6125 1066.29 44.4412 1064.14 Q46.2931 1061.96 46.2931 1058.24 Q46.2931 1054.49 44.4412 1052.33 Q42.6125 1050.18 39.4644 1050.18 M48.7468 1035.53 L48.7468 1039.79 Q46.9875 1038.95 45.182 1038.51 Q43.3996 1038.07 41.6403 1038.07 Q37.0107 1038.07 34.557 1041.2 Q32.1265 1044.32 31.7793 1050.64 Q33.145 1048.63 35.2052 1047.56 Q37.2653 1046.48 39.7422 1046.48 Q44.9505 1046.48 47.9597 1049.65 Q50.9921 1052.8 50.9921 1058.24 Q50.9921 1063.56 47.844 1066.78 Q44.6959 1069.99 39.4644 1069.99 Q33.4691 1069.99 30.2978 1065.41 Q27.1265 1060.8 27.1265 1052.08 Q27.1265 1043.88 31.0154 1039.02 Q34.9042 1034.14 41.4551 1034.14 Q43.2144 1034.14 44.9968 1034.49 Q46.8023 1034.83 48.7468 1035.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M-11.2066 760.276 L18.4692 760.276 L18.4692 764.212 L-11.2066 764.212 L-11.2066 760.276 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M41.4088 746.619 L29.6034 765.068 L41.4088 765.068 L41.4088 746.619 M40.182 742.545 L46.0616 742.545 L46.0616 765.068 L50.9921 765.068 L50.9921 768.957 L46.0616 768.957 L46.0616 777.105 L41.4088 777.105 L41.4088 768.957 L25.8071 768.957 L25.8071 764.443 L40.182 742.545 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M-9.12329 468.058 L20.5525 468.058 L20.5525 471.993 L-9.12329 471.993 L-9.12329 468.058 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M34.6728 480.952 L50.9921 480.952 L50.9921 484.887 L29.0478 484.887 L29.0478 480.952 Q31.7098 478.197 36.2931 473.567 Q40.8996 468.915 42.0801 467.572 Q44.3255 465.049 45.2051 463.313 Q46.1079 461.554 46.1079 459.864 Q46.1079 457.109 44.1635 455.373 Q42.2422 453.637 39.1403 453.637 Q36.9413 453.637 34.4876 454.401 Q32.057 455.165 29.2793 456.716 L29.2793 451.994 Q32.1033 450.859 34.557 450.281 Q37.0107 449.702 39.0477 449.702 Q44.4181 449.702 47.6125 452.387 Q50.8069 455.072 50.8069 459.563 Q50.8069 461.693 49.9968 463.614 Q49.2097 465.512 47.1033 468.105 Q46.5246 468.776 43.4227 471.993 Q40.3209 475.188 34.6728 480.952 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M39.0477 161.187 Q35.4367 161.187 33.608 164.752 Q31.8024 168.294 31.8024 175.423 Q31.8024 182.53 33.608 186.095 Q35.4367 189.636 39.0477 189.636 Q42.682 189.636 44.4875 186.095 Q46.3162 182.53 46.3162 175.423 Q46.3162 168.294 44.4875 164.752 Q42.682 161.187 39.0477 161.187 M39.0477 157.484 Q44.8579 157.484 47.9134 162.09 Q50.9921 166.673 50.9921 175.423 Q50.9921 184.15 47.9134 188.757 Q44.8579 193.34 39.0477 193.34 Q33.2376 193.34 30.1589 188.757 Q27.1034 184.15 27.1034 175.423 Q27.1034 166.673 30.1589 162.09 Q33.2376 157.484 39.0477 157.484 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip982)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,88.5087 313.569,1281.56 540.145,1464 766.721,1447.11 993.298,1393.04 1219.87,1334.06 1446.45,1276.5 1673.03,1221.52 1899.6,1169.23 2126.18,1119.54 
  2352.76,1072.34 
  "/>
<polyline clip-path="url(#clip982)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,367.116 313.569,213.734 540.145,183.058 766.721,176.923 993.298,175.695 1219.87,175.45 1446.45,175.401 1673.03,175.391 1899.6,175.389 2126.18,175.389 
  2352.76,175.389 
  "/>
<path clip-path="url(#clip980)" d="
M1917.79 251.365 L2277.23 251.365 L2277.23 95.8446 L1917.79 95.8446  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip980)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1917.79,251.365 2277.23,251.365 2277.23,95.8446 1917.79,95.8446 1917.79,251.365 
  "/>
<polyline clip-path="url(#clip980)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1942.97,147.685 2094.02,147.685 
  "/>
<path clip-path="url(#clip980)" d="M2119.2 154.733 L2119.2 139.039 L2123.45 139.039 L2123.45 154.571 Q2123.45 158.252 2124.89 160.104 Q2126.33 161.932 2129.2 161.932 Q2132.64 161.932 2134.64 159.733 Q2136.65 157.534 2136.65 153.738 L2136.65 139.039 L2140.91 139.039 L2140.91 164.965 L2136.65 164.965 L2136.65 160.983 Q2135.1 163.344 2133.04 164.502 Q2131 165.636 2128.29 165.636 Q2123.83 165.636 2121.51 162.858 Q2119.2 160.08 2119.2 154.733 M2129.91 138.414 L2129.91 138.414 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2151.09 161.029 L2158.73 161.029 L2158.73 134.664 L2150.42 136.331 L2150.42 132.071 L2158.69 130.405 L2163.36 130.405 L2163.36 161.029 L2171 161.029 L2171 164.965 L2151.09 164.965 L2151.09 161.029 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2190.07 128.993 Q2186.97 134.317 2185.47 139.525 Q2183.96 144.733 2183.96 150.08 Q2183.96 155.428 2185.47 160.682 Q2187 165.914 2190.07 171.215 L2186.37 171.215 Q2182.9 165.775 2181.16 160.52 Q2179.45 155.266 2179.45 150.08 Q2179.45 144.918 2181.16 139.687 Q2182.88 134.456 2186.37 128.993 L2190.07 128.993 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2202.55 131.678 L2202.55 139.039 L2211.32 139.039 L2211.32 142.349 L2202.55 142.349 L2202.55 156.423 Q2202.55 159.594 2203.41 160.497 Q2204.29 161.4 2206.95 161.4 L2211.32 161.4 L2211.32 164.965 L2206.95 164.965 Q2202.02 164.965 2200.14 163.136 Q2198.27 161.284 2198.27 156.423 L2198.27 142.349 L2195.14 142.349 L2195.14 139.039 L2198.27 139.039 L2198.27 131.678 L2202.55 131.678 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2216.26 128.993 L2219.96 128.993 Q2223.43 134.456 2225.14 139.687 Q2226.88 144.918 2226.88 150.08 Q2226.88 155.266 2225.14 160.52 Q2223.43 165.775 2219.96 171.215 L2216.26 171.215 Q2219.33 165.914 2220.84 160.682 Q2222.37 155.428 2222.37 150.08 Q2222.37 144.733 2220.84 139.525 Q2219.33 134.317 2216.26 128.993 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip980)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1942.97,199.525 2094.02,199.525 
  "/>
<path clip-path="url(#clip980)" d="M2119.2 206.573 L2119.2 190.879 L2123.45 190.879 L2123.45 206.411 Q2123.45 210.092 2124.89 211.944 Q2126.33 213.772 2129.2 213.772 Q2132.64 213.772 2134.64 211.573 Q2136.65 209.374 2136.65 205.578 L2136.65 190.879 L2140.91 190.879 L2140.91 216.805 L2136.65 216.805 L2136.65 212.823 Q2135.1 215.184 2133.04 216.342 Q2131 217.476 2128.29 217.476 Q2123.83 217.476 2121.51 214.698 Q2119.2 211.92 2119.2 206.573 M2129.91 190.254 L2129.91 190.254 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2154.31 212.869 L2170.63 212.869 L2170.63 216.805 L2148.69 216.805 L2148.69 212.869 Q2151.35 210.115 2155.93 205.485 Q2160.54 200.832 2161.72 199.49 Q2163.96 196.967 2164.84 195.231 Q2165.75 193.471 2165.75 191.782 Q2165.75 189.027 2163.8 187.291 Q2161.88 185.555 2158.78 185.555 Q2156.58 185.555 2154.13 186.319 Q2151.7 187.083 2148.92 188.633 L2148.92 183.911 Q2151.74 182.777 2154.2 182.198 Q2156.65 181.62 2158.69 181.62 Q2164.06 181.62 2167.25 184.305 Q2170.45 186.99 2170.45 191.481 Q2170.45 193.61 2169.64 195.532 Q2168.85 197.43 2166.74 200.022 Q2166.16 200.694 2163.06 203.911 Q2159.96 207.106 2154.31 212.869 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2190.07 180.833 Q2186.97 186.157 2185.47 191.365 Q2183.96 196.573 2183.96 201.92 Q2183.96 207.268 2185.47 212.522 Q2187 217.754 2190.07 223.055 L2186.37 223.055 Q2182.9 217.615 2181.16 212.36 Q2179.45 207.106 2179.45 201.92 Q2179.45 196.758 2181.16 191.527 Q2182.88 186.296 2186.37 180.833 L2190.07 180.833 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2202.55 183.518 L2202.55 190.879 L2211.32 190.879 L2211.32 194.189 L2202.55 194.189 L2202.55 208.263 Q2202.55 211.434 2203.41 212.337 Q2204.29 213.24 2206.95 213.24 L2211.32 213.24 L2211.32 216.805 L2206.95 216.805 Q2202.02 216.805 2200.14 214.976 Q2198.27 213.124 2198.27 208.263 L2198.27 194.189 L2195.14 194.189 L2195.14 190.879 L2198.27 190.879 L2198.27 183.518 L2202.55 183.518 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip980)" d="M2216.26 180.833 L2219.96 180.833 Q2223.43 186.296 2225.14 191.527 Q2226.88 196.758 2226.88 201.92 Q2226.88 207.106 2225.14 212.36 Q2223.43 217.615 2219.96 223.055 L2216.26 223.055 Q2219.33 217.754 2220.84 212.522 Q2222.37 207.268 2222.37 201.92 Q2222.37 196.573 2220.84 191.365 Q2219.33 186.157 2216.26 180.833 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>With this, we can simulate an ensemble of solutions from different initial conditions (and we will turn back on the noise).  The <code>EnsembleSummary</code> calculates a set of quantiles by default.</p><pre><code class="language-julia hljs">T = 10
trajectories = 50
prob = LinearStateSpaceProblem(A, B, u0, (0, T); C)
sol = solve(EnsembleProblem(prob), DirectIteration(), EnsembleThreads(); trajectories)
summ = EnsembleSummary(sol)  #calculate summarize statistics from the
plot(summ)  # shows quantiles by default</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip040">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip040)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip041">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip040)" d="
M86.9921 1521.01 L2352.76 1521.01 L2352.76 47.2441 L86.9921 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip042">
    <rect x="86" y="47" width="2267" height="1475"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  151.118,1521.01 151.118,47.2441 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  685.496,1521.01 685.496,47.2441 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1219.87,1521.01 1219.87,47.2441 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1754.25,1521.01 1754.25,47.2441 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2288.63,1521.01 2288.63,47.2441 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 2352.76,1521.01 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  151.118,1521.01 151.118,1502.11 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  685.496,1521.01 685.496,1502.11 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1219.87,1521.01 1219.87,1502.11 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1754.25,1521.01 1754.25,1502.11 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2288.63,1521.01 2288.63,1502.11 
  "/>
<path clip-path="url(#clip040)" d="M128.502 1551.93 Q124.891 1551.93 123.062 1555.49 Q121.257 1559.03 121.257 1566.16 Q121.257 1573.27 123.062 1576.83 Q124.891 1580.38 128.502 1580.38 Q132.136 1580.38 133.942 1576.83 Q135.77 1573.27 135.77 1566.16 Q135.77 1559.03 133.942 1555.49 Q132.136 1551.93 128.502 1551.93 M128.502 1548.22 Q134.312 1548.22 137.368 1552.83 Q140.446 1557.41 140.446 1566.16 Q140.446 1574.89 137.368 1579.5 Q134.312 1584.08 128.502 1584.08 Q122.692 1584.08 119.613 1579.5 Q116.558 1574.89 116.558 1566.16 Q116.558 1557.41 119.613 1552.83 Q122.692 1548.22 128.502 1548.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M148.664 1577.53 L153.548 1577.53 L153.548 1583.41 L148.664 1583.41 L148.664 1577.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M173.733 1551.93 Q170.122 1551.93 168.293 1555.49 Q166.488 1559.03 166.488 1566.16 Q166.488 1573.27 168.293 1576.83 Q170.122 1580.38 173.733 1580.38 Q177.367 1580.38 179.173 1576.83 Q181.002 1573.27 181.002 1566.16 Q181.002 1559.03 179.173 1555.49 Q177.367 1551.93 173.733 1551.93 M173.733 1548.22 Q179.543 1548.22 182.599 1552.83 Q185.678 1557.41 185.678 1566.16 Q185.678 1574.89 182.599 1579.5 Q179.543 1584.08 173.733 1584.08 Q167.923 1584.08 164.844 1579.5 Q161.789 1574.89 161.789 1566.16 Q161.789 1557.41 164.844 1552.83 Q167.923 1548.22 173.733 1548.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M657.232 1579.47 L673.551 1579.47 L673.551 1583.41 L651.607 1583.41 L651.607 1579.47 Q654.269 1576.72 658.852 1572.09 Q663.459 1567.44 664.639 1566.09 Q666.885 1563.57 667.764 1561.83 Q668.667 1560.07 668.667 1558.38 Q668.667 1555.63 666.723 1553.89 Q664.801 1552.16 661.7 1552.16 Q659.501 1552.16 657.047 1552.92 Q654.616 1553.69 651.839 1555.24 L651.839 1550.51 Q654.663 1549.38 657.116 1548.8 Q659.57 1548.22 661.607 1548.22 Q666.977 1548.22 670.172 1550.91 Q673.366 1553.59 673.366 1558.08 Q673.366 1560.21 672.556 1562.13 Q671.769 1564.03 669.663 1566.63 Q669.084 1567.3 665.982 1570.51 Q662.88 1573.71 657.232 1579.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M683.366 1577.53 L688.25 1577.53 L688.25 1583.41 L683.366 1583.41 L683.366 1577.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M698.482 1548.85 L716.838 1548.85 L716.838 1552.78 L702.764 1552.78 L702.764 1561.26 Q703.783 1560.91 704.801 1560.75 Q705.82 1560.56 706.838 1560.56 Q712.625 1560.56 716.005 1563.73 Q719.384 1566.9 719.384 1572.32 Q719.384 1577.9 715.912 1581 Q712.44 1584.08 706.121 1584.08 Q703.945 1584.08 701.676 1583.71 Q699.431 1583.34 697.023 1582.6 L697.023 1577.9 Q699.107 1579.03 701.329 1579.59 Q703.551 1580.14 706.028 1580.14 Q710.033 1580.14 712.371 1578.04 Q714.709 1575.93 714.709 1572.32 Q714.709 1568.71 712.371 1566.6 Q710.033 1564.5 706.028 1564.5 Q704.153 1564.5 702.278 1564.91 Q700.426 1565.33 698.482 1566.21 L698.482 1548.85 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1187.04 1548.85 L1205.39 1548.85 L1205.39 1552.78 L1191.32 1552.78 L1191.32 1561.26 Q1192.34 1560.91 1193.36 1560.75 Q1194.38 1560.56 1195.39 1560.56 Q1201.18 1560.56 1204.56 1563.73 Q1207.94 1566.9 1207.94 1572.32 Q1207.94 1577.9 1204.47 1581 Q1201 1584.08 1194.68 1584.08 Q1192.5 1584.08 1190.23 1583.71 Q1187.99 1583.34 1185.58 1582.6 L1185.58 1577.9 Q1187.66 1579.03 1189.89 1579.59 Q1192.11 1580.14 1194.58 1580.14 Q1198.59 1580.14 1200.93 1578.04 Q1203.27 1575.93 1203.27 1572.32 Q1203.27 1568.71 1200.93 1566.6 Q1198.59 1564.5 1194.58 1564.5 Q1192.71 1564.5 1190.83 1564.91 Q1188.98 1565.33 1187.04 1566.21 L1187.04 1548.85 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1217.15 1577.53 L1222.04 1577.53 L1222.04 1583.41 L1217.15 1583.41 L1217.15 1577.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1242.22 1551.93 Q1238.61 1551.93 1236.78 1555.49 Q1234.98 1559.03 1234.98 1566.16 Q1234.98 1573.27 1236.78 1576.83 Q1238.61 1580.38 1242.22 1580.38 Q1245.86 1580.38 1247.66 1576.83 Q1249.49 1573.27 1249.49 1566.16 Q1249.49 1559.03 1247.66 1555.49 Q1245.86 1551.93 1242.22 1551.93 M1242.22 1548.22 Q1248.03 1548.22 1251.09 1552.83 Q1254.17 1557.41 1254.17 1566.16 Q1254.17 1574.89 1251.09 1579.5 Q1248.03 1584.08 1242.22 1584.08 Q1236.41 1584.08 1233.33 1579.5 Q1230.28 1574.89 1230.28 1566.16 Q1230.28 1557.41 1233.33 1552.83 Q1236.41 1548.22 1242.22 1548.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1720.57 1548.85 L1742.79 1548.85 L1742.79 1550.84 L1730.25 1583.41 L1725.36 1583.41 L1737.17 1552.78 L1720.57 1552.78 L1720.57 1548.85 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1751.91 1577.53 L1756.8 1577.53 L1756.8 1583.41 L1751.91 1583.41 L1751.91 1577.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M1767.03 1548.85 L1785.39 1548.85 L1785.39 1552.78 L1771.31 1552.78 L1771.31 1561.26 Q1772.33 1560.91 1773.35 1560.75 Q1774.37 1560.56 1775.39 1560.56 Q1781.17 1560.56 1784.55 1563.73 Q1787.93 1566.9 1787.93 1572.32 Q1787.93 1577.9 1784.46 1581 Q1780.99 1584.08 1774.67 1584.08 Q1772.49 1584.08 1770.22 1583.71 Q1767.98 1583.34 1765.57 1582.6 L1765.57 1577.9 Q1767.65 1579.03 1769.88 1579.59 Q1772.1 1580.14 1774.58 1580.14 Q1778.58 1580.14 1780.92 1578.04 Q1783.26 1575.93 1783.26 1572.32 Q1783.26 1568.71 1780.92 1566.6 Q1778.58 1564.5 1774.58 1564.5 Q1772.7 1564.5 1770.83 1564.91 Q1768.97 1565.33 1767.03 1566.21 L1767.03 1548.85 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M2240.7 1579.47 L2248.34 1579.47 L2248.34 1553.11 L2240.03 1554.77 L2240.03 1550.51 L2248.3 1548.85 L2252.97 1548.85 L2252.97 1579.47 L2260.61 1579.47 L2260.61 1583.41 L2240.7 1583.41 L2240.7 1579.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M2280.05 1551.93 Q2276.44 1551.93 2274.61 1555.49 Q2272.81 1559.03 2272.81 1566.16 Q2272.81 1573.27 2274.61 1576.83 Q2276.44 1580.38 2280.05 1580.38 Q2283.69 1580.38 2285.49 1576.83 Q2287.32 1573.27 2287.32 1566.16 Q2287.32 1559.03 2285.49 1555.49 Q2283.69 1551.93 2280.05 1551.93 M2280.05 1548.22 Q2285.86 1548.22 2288.92 1552.83 Q2292 1557.41 2292 1566.16 Q2292 1574.89 2288.92 1579.5 Q2285.86 1584.08 2280.05 1584.08 Q2274.24 1584.08 2271.17 1579.5 Q2268.11 1574.89 2268.11 1566.16 Q2268.11 1557.41 2271.17 1552.83 Q2274.24 1548.22 2280.05 1548.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M2300.22 1577.53 L2305.1 1577.53 L2305.1 1583.41 L2300.22 1583.41 L2300.22 1577.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M2325.29 1551.93 Q2321.67 1551.93 2319.85 1555.49 Q2318.04 1559.03 2318.04 1566.16 Q2318.04 1573.27 2319.85 1576.83 Q2321.67 1580.38 2325.29 1580.38 Q2328.92 1580.38 2330.73 1576.83 Q2332.55 1573.27 2332.55 1566.16 Q2332.55 1559.03 2330.73 1555.49 Q2328.92 1551.93 2325.29 1551.93 M2325.29 1548.22 Q2331.1 1548.22 2334.15 1552.83 Q2337.23 1557.41 2337.23 1566.16 Q2337.23 1574.89 2334.15 1579.5 Q2331.1 1584.08 2325.29 1584.08 Q2319.48 1584.08 2316.4 1579.5 Q2313.34 1574.89 2313.34 1566.16 Q2313.34 1557.41 2316.4 1552.83 Q2319.48 1548.22 2325.29 1548.22 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1464.87 2352.76,1464.87 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,1152.09 2352.76,1152.09 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,839.306 2352.76,839.306 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,526.526 2352.76,526.526 
  "/>
<polyline clip-path="url(#clip042)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  86.9921,213.745 2352.76,213.745 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1521.01 86.9921,47.2441 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1464.87 105.89,1464.87 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,1152.09 105.89,1152.09 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,839.306 105.89,839.306 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,526.526 105.89,526.526 
  "/>
<polyline clip-path="url(#clip040)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  86.9921,213.745 105.89,213.745 
  "/>
<path clip-path="url(#clip040)" d="M-40.8824 1465.32 L-11.2066 1465.32 L-11.2066 1469.25 L-40.8824 1469.25 L-40.8824 1465.32 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M-0.303895 1478.21 L7.33495 1478.21 L7.33495 1451.85 L-0.975188 1453.51 L-0.975188 1449.25 L7.28866 1447.59 L11.9646 1447.59 L11.9646 1478.21 L19.6034 1478.21 L19.6034 1482.15 L-0.303895 1482.15 L-0.303895 1478.21 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M39.0477 1450.67 Q35.4367 1450.67 33.608 1454.23 Q31.8024 1457.77 31.8024 1464.9 Q31.8024 1472.01 33.608 1475.57 Q35.4367 1479.11 39.0477 1479.11 Q42.682 1479.11 44.4875 1475.57 Q46.3162 1472.01 46.3162 1464.9 Q46.3162 1457.77 44.4875 1454.23 Q42.682 1450.67 39.0477 1450.67 M39.0477 1446.96 Q44.8579 1446.96 47.9134 1451.57 Q50.9921 1456.15 50.9921 1464.9 Q50.9921 1473.63 47.9134 1478.24 Q44.8579 1482.82 39.0477 1482.82 Q33.2376 1482.82 30.1589 1478.24 Q27.1034 1473.63 27.1034 1464.9 Q27.1034 1456.15 30.1589 1451.57 Q33.2376 1446.96 39.0477 1446.96 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M-9.72514 1152.54 L19.9506 1152.54 L19.9506 1156.47 L-9.72514 1156.47 L-9.72514 1152.54 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M30.0895 1134.81 L48.4458 1134.81 L48.4458 1138.74 L34.3718 1138.74 L34.3718 1147.21 Q35.3904 1146.87 36.4089 1146.7 Q37.4274 1146.52 38.4459 1146.52 Q44.2329 1146.52 47.6125 1149.69 Q50.9921 1152.86 50.9921 1158.28 Q50.9921 1163.86 47.5199 1166.96 Q44.0477 1170.04 37.7283 1170.04 Q35.5524 1170.04 33.2839 1169.67 Q31.0385 1169.3 28.6311 1168.56 L28.6311 1163.86 Q30.7145 1164.99 32.9367 1165.55 Q35.1589 1166.1 37.6357 1166.1 Q41.6403 1166.1 43.9783 1164 Q46.3162 1161.89 46.3162 1158.28 Q46.3162 1154.67 43.9783 1152.56 Q41.6403 1150.45 37.6357 1150.45 Q35.7607 1150.45 33.8857 1150.87 Q32.0339 1151.29 30.0895 1152.17 L30.0895 1134.81 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M39.0477 825.105 Q35.4367 825.105 33.608 828.67 Q31.8024 832.211 31.8024 839.341 Q31.8024 846.447 33.608 850.012 Q35.4367 853.554 39.0477 853.554 Q42.682 853.554 44.4875 850.012 Q46.3162 846.447 46.3162 839.341 Q46.3162 832.211 44.4875 828.67 Q42.682 825.105 39.0477 825.105 M39.0477 821.401 Q44.8579 821.401 47.9134 826.008 Q50.9921 830.591 50.9921 839.341 Q50.9921 848.068 47.9134 852.674 Q44.8579 857.257 39.0477 857.257 Q33.2376 857.257 30.1589 852.674 Q27.1034 848.068 27.1034 839.341 Q27.1034 830.591 30.1589 826.008 Q33.2376 821.401 39.0477 821.401 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M30.0895 509.246 L48.4458 509.246 L48.4458 513.181 L34.3718 513.181 L34.3718 521.653 Q35.3904 521.306 36.4089 521.144 Q37.4274 520.958 38.4459 520.958 Q44.2329 520.958 47.6125 524.13 Q50.9921 527.301 50.9921 532.718 Q50.9921 538.296 47.5199 541.398 Q44.0477 544.477 37.7283 544.477 Q35.5524 544.477 33.2839 544.106 Q31.0385 543.736 28.6311 542.995 L28.6311 538.296 Q30.7145 539.431 32.9367 539.986 Q35.1589 540.542 37.6357 540.542 Q41.6403 540.542 43.9783 538.435 Q46.3162 536.329 46.3162 532.718 Q46.3162 529.107 43.9783 527 Q41.6403 524.894 37.6357 524.894 Q35.7607 524.894 33.8857 525.31 Q32.0339 525.727 30.0895 526.607 L30.0895 509.246 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M-0.303895 227.09 L7.33495 227.09 L7.33495 200.724 L-0.975188 202.391 L-0.975188 198.132 L7.28866 196.465 L11.9646 196.465 L11.9646 227.09 L19.6034 227.09 L19.6034 231.025 L-0.303895 231.025 L-0.303895 227.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip040)" d="M39.0477 199.544 Q35.4367 199.544 33.608 203.108 Q31.8024 206.65 31.8024 213.78 Q31.8024 220.886 33.608 224.451 Q35.4367 227.993 39.0477 227.993 Q42.682 227.993 44.4875 224.451 Q46.3162 220.886 46.3162 213.78 Q46.3162 206.65 44.4875 203.108 Q42.682 199.544 39.0477 199.544 M39.0477 195.84 Q44.8579 195.84 47.9134 200.446 Q50.9921 205.03 50.9921 213.78 Q50.9921 222.506 47.9134 227.113 Q44.8579 231.696 39.0477 231.696 Q33.2376 231.696 30.1589 227.113 Q27.1034 222.506 27.1034 213.78 Q27.1034 205.03 30.1589 200.446 Q33.2376 195.84 39.0477 195.84 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip042)" d="
M151.118 925.561 L364.869 1397.57 L578.62 1479.3 L792.371 1470.31 L1006.12 1441.45 L1219.87 1410.48 L1433.63 1385.13 L1647.38 1358.82 L1861.13 1332.22 L2074.88 1307.52 
  L2288.63 1288.21 L2288.63 322.39 L2074.88 292.717 L1861.13 266.214 L1647.38 232.319 L1433.63 204.154 L1219.87 171.952 L1006.12 139.951 L792.371 102.401 L578.62 88.9544 
  L364.869 174.508 L151.118 756.045  Z
  " fill="#009af9" fill-rule="evenodd" fill-opacity="0.2"/>
<polyline clip-path="url(#clip042)" style="stroke:#009af9; stroke-linecap:butt; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="
  151.118,846.89 364.869,786.053 578.62,759.654 792.371,759.924 1006.12,761.027 1219.87,766.298 1433.63,770.966 1647.38,775.837 1861.13,775.703 2074.88,781.655 
  2288.63,788.66 
  "/>
<path clip-path="url(#clip042)" d="
M151.118 923.809 L364.869 855.922 L578.62 843.573 L792.371 840.724 L1006.12 840.474 L1219.87 840.398 L1433.63 840.463 L1647.38 840.461 L1861.13 840.223 L2074.88 840.204 
  L2288.63 840.505 L2288.63 838.106 L2074.88 838.171 L1861.13 838.476 L1647.38 838.165 L1433.63 838.064 L1219.87 838.163 L1006.12 838.416 L792.371 838.407 L578.62 835.48 
  L364.869 820.14 L151.118 742.178  Z
  " fill="#e26f46" fill-rule="evenodd" fill-opacity="0.2"/>
<polyline clip-path="url(#clip042)" style="stroke:#e26f46; stroke-linecap:butt; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="
  151.118,822.035 364.869,836.304 578.62,838.898 792.371,839.569 1006.12,839.347 1219.87,839.35 1433.63,839.505 1647.38,839.447 1861.13,839.347 2074.88,839.401 
  2288.63,839.183 
  "/>
</svg>
<h2 id="Observables-and-Marginal-Likelihood-using-a-Kalman-Filter"><a class="docs-heading-anchor" href="#Observables-and-Marginal-Likelihood-using-a-Kalman-Filter">Observables and Marginal Likelihood using a Kalman Filter</a><a id="Observables-and-Marginal-Likelihood-using-a-Kalman-Filter-1"></a><a class="docs-heading-anchor-permalink" href="#Observables-and-Marginal-Likelihood-using-a-Kalman-Filter" title="Permalink"></a></h2><p>If you provide <code>observables</code> and provide a distribution for the <code>observables_noise</code> then the model can provide a calculation of the likelihood.  </p><p>The simplest case is if you use a gaussian prior and have gaussian observation noise.  First, lets simulate some data with included observation noise.  If passing in a matrix or vector, the <code>observables_noise</code> argument is intended to be the cholesky of the covariance matrix.  At this point, only diagonal observation noise is allowed.</p><pre><code class="language-julia hljs">u0 = MvNormal([1.0 0.1; 0.1 1.0])  # draw from mean zero initial conditions
T = 10
prob = LinearStateSpaceProblem(A, B, u0, (0, T); C, observables_noise = D, syms = [:a, :b])
sol = solve(prob)
sol.z # simulated observables with observation noise</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">11-element Vector{Vector{Float64}}:
 [-0.9572449182021927, 0.5462179955945057]
 [-0.5828234555842212, -3.588466295665652]
 [-0.9609525122812667, -4.4318420621242165]
 [0.04155525890832268, -3.7929325736382116]
 [-0.4070023269326224, -3.948862282110671]
 [-0.7433643102124003, -3.421303874045265]
 [-0.29013434073528876, -2.496892746220793]
 [-0.4760817403011013, -3.036077062751539]
 [0.15143667266697047, -3.0334767984349726]
 [-0.1323652117906129, -2.818834860769587]
 [0.2364875110082119, -2.4333363849747776]</code></pre><p>Next we will find the log likelihood of these simulated observables using the <code>u0</code> as a prior and with the true parameters.</p><p>The new arguments we pass to the problem creation are <code>u0_prior_variance, u0_prior_mean,</code> and <code>observables</code>.  The <code>u0</code> is ignored for the filtering problem but must match the size.  The <code>KalmanFilter()</code> argument to the <code>solve</code> is unnecessary since it can select it manually given the priors and observables.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The timing convention is such that <code>observables</code> are expected to match the predictions starting at the second time period.  As the likelihood of the first element <code>u0</code> comes from a prior, the <code>observables</code> start at the next element, and hence the observables and noise sequences should be 1 less than the tspan </p></div></div><pre><code class="language-julia hljs">observables = hcat(sol.z...)  # Observables required to be matrix.  Issue #55
observables = observables[:, 2:end] # see note above on likelihood and timing
noise = copy(sol.W) # save for later
u0_prior_mean = [0.0, 0.0]
# use covariance of distribution we drew from
u0_prior_var = cov(u0)

prob = LinearStateSpaceProblem(A, B, u0, (0, size(observables,2)); C, observables, observables_noise = D, syms = [:a, :b], u0_prior_var, u0_prior_mean)
sol = solve(prob, KalmanFilter())
# plot(sol) The `u` is the sequence of posterior means.
sol.logpdf</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-11.09824889882038</code></pre><p>Hence the <code>logpdf</code> provides the log likelihood marginalizing out the latent noise variables.</p><p>As before, we can differentiate the kalman filter itself.</p><pre><code class="language-julia hljs">function kalman_likelihood(A, B, C, D, u0_prior_mean, u0_prior_var, observables)
    prob = LinearStateSpaceProblem(A, B, u0, (0, size(observables,2)); C, observables, observables_noise = D, syms = [:a, :b], u0_prior_var, u0_prior_mean)
    return solve(prob).logpdf
end
kalman_likelihood(A, B, C, D, u0_prior_mean, u0_prior_var, observables)
# Find the gradient wrt the A, B, C and priors variance.
gradient((A, B, C, u0_prior_var) -&gt; kalman_likelihood(A, B, C, D, u0_prior_mean, u0_prior_var, observables), A, B, C, u0_prior_var)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([-119.13701015006805 -0.0838998729559639; -878.8733497280687 -11.535010831046277], [5.058431359156826; 39.92560964932054;;], [11.93547148367891 0.27214584433958267; -1.7003471657150726 0.17151071182465127], [-0.05768938475144199 0.8176515341869806; -0.7236190377300274 -0.3732504213791792])</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Some of the gradients, such as those for <code>observables</code>, have not been implemented so test carefully.  This is a general theme with gradients and <code>Zygote.jl</code> in general.  Your best friend in this process is the spectacular <a href="https://github.com/JuliaDiff/ChainRulesTestUtils.jl">ChainRulesTestUtils.jl</a> package. See <code>test_rrule</code> usage in the <a href="https://github.com/SciML/DifferenceEquations.jl/blob/main/test/linear_gradients.jl">linear unit tests</a>.</p></div></div><h2 id="Joint-Likelihood-with-Noise"><a class="docs-heading-anchor" href="#Joint-Likelihood-with-Noise">Joint Likelihood with Noise</a><a id="Joint-Likelihood-with-Noise-1"></a><a class="docs-heading-anchor-permalink" href="#Joint-Likelihood-with-Noise" title="Permalink"></a></h2><p>A key application of these methods is to find the joint likelihood of the latent variables (i.e., the <code>noise</code>) and the model definition.</p><p>The actual calculation of the likelihood is trivial in that case, and just requires iteration of the linear system while accumulating the likelihood given the observation noise.</p><p>Crucially, the differentiability with respect to the high-dimensional noise vector enables gradient-based sampling and estimation methods which would otherwise be infeasible.</p><pre><code class="language-julia hljs">function joint_likelihood(A, B, C, D, u0, noise, observables)
    prob = LinearStateSpaceProblem(A, B, u0, (0, size(observables,2)); C, observables, observables_noise = D, noise)
    return solve(prob).logpdf
end
u0 = [0.0, 0.0]
joint_likelihood(A, B, C, D, u0, noise, observables)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-618.8249955041551</code></pre><p>And as always, this can be differentiated with respect to the state-space matrices and the noise.  Choosing a few parameters,</p><pre><code class="language-julia hljs">gradient((A, u0, noise) -&gt; joint_likelihood(A, B, C, D, u0, noise, observables), A, u0, noise)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([-166.221765592625 -7.8832098996376425; -950.64241069287 -51.72193164449178], [-270.23453352598085, -2156.0243960766015], [-19.619424653246842 -16.95913624252548 … -1.5739022567022372 0.015239998471199705])</code></pre><h2 id="Composition-of-State-Space-Models-and-AD"><a class="docs-heading-anchor" href="#Composition-of-State-Space-Models-and-AD">Composition of State Space Models and AD</a><a id="Composition-of-State-Space-Models-and-AD-1"></a><a class="docs-heading-anchor-permalink" href="#Composition-of-State-Space-Models-and-AD" title="Permalink"></a></h2><p>While the above gradients have been with respect to the full state space objects <code>A, B</code>, etc. those themselves could be generated through a separate procedure and the whole object differentiated.  For example, lets repeat the above examples where we generate the <code>A</code> matrix from some sort of deep parameters.</p><p>First we will generate some observations with a <code>generate_model</code> proxy–-which could be replaced with something more complicated but still differentiable</p><pre><code class="language-julia hljs">function generate_model(β)
    A = [β 6.2;
        0.0  0.2]
    B = Matrix([0.0  0.001]&#39;) # [0.0; 0.001;;] gives a zygote bug
    C = [0.09 0.67;
        1.00 0.00]
    D = [0.01, 0.01]
    return (;A,B,C,D)
end

function simulate_model(β, u0;T = 200)
    mod = generate_model(β)
    prob = LinearStateSpaceProblem(mod.A, mod.B, u0, (0, T); mod.C, observables_noise = mod.D)
    sol = solve(prob) # simulates
    observables = hcat(sol.z...)
    observables = observables[:, 2:end] # see note above on likelihood and timing
    return observables, sol.W
end

# Fix a &quot;pseudo-true&quot; and generate noise and observables
β = 0.95
u0 = [0.0, 0.0]
observables, noise = simulate_model(β, u0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([-0.05180933486447245 0.15602795145097215 … -0.08375257943963711 -0.01831709011440147; 0.0014203357393008191 -0.06846428207347235 … -0.09561294578080469 0.03319145401216023], [1.2518784041653743 -0.5527316200827356 … 1.4172677644173242 -0.7483186715016297])</code></pre><p>Next, we will evaluate the marginal likelihood using the kalman filter for a particular <code>β</code> value,</p><pre><code class="language-julia hljs">function kalman_model_likelihood(β, u0_prior_mean, u0_prior_var, observables)
    mod = generate_model(β) # generate model from structural parameters
    prob = LinearStateSpaceProblem(mod.A, mod.B, u0, (0, size(observables,2)); mod.C, observables,      observables_noise = mod.D, u0_prior_var, u0_prior_mean)
    return solve(prob).logpdf
end
u0_prior_mean = [0.0, 0.0]
u0_prior_var = [1e-10 0.0;
                0.0 1e-10]  # starting with degenerate prior
kalman_model_likelihood(β, u0_prior_mean, u0_prior_var, observables)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">361.8081214385129</code></pre><p>Given the observation error we would not expect the pseudo-true to exactly maximimize the log likelihood.  To show this, we can optimize it using using the Optim package and using a gradient-based optimization routine</p><pre><code class="language-julia hljs">using Optimization, OptimizationOptimJL
# Create a function to minimize only of β and use Zygote based gradients
kalman_objective(β,p) = -kalman_model_likelihood(β, u0_prior_mean, u0_prior_var, observables)
kalman_objective(0.95, nothing)
gradient(β -&gt;kalman_objective(β, nothing),β) # Verifying it can be differentiated


optf = OptimizationFunction(kalman_objective, Optimization.AutoZygote())
β0 = [0.91] # start off of the pseudotrue
optprob = OptimizationProblem(optf, β0)
optsol = solve(optprob,LBFGS())  # reverse-mode AD is overkill here</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 1-element Vector{Float64}:
 0.9555361894672562</code></pre><p>In this way, this package composes with others such as <a href="https://github.com/HighDimensionalEconLab/DifferentiableStateSpaceModels.jl">DifferentiableStateSpaceModels.jl</a> which take a set of structural parameters and an expectational difference equation and generate a state-space model.</p><p>Similarly, we can find the joint likelihood for a particular <code>β</code> value and noise.  Here we will add in prior.  Some form of a prior or regularization is generally necessary for these sorts of nonlinear models.</p><pre><code class="language-julia hljs">function joint_model_posterior(β, u0, noise, observables, noise_prior, β_prior)
    mod = generate_model(β) # generate model from structural parameters
    prob = LinearStateSpaceProblem(mod.A, mod.B, u0, (0, size(observables,2)); mod.C, observables,      observables_noise = mod.D, noise)
    return solve(prob).logpdf + sum(logpdf.(noise_prior, noise)) + logpdf(β_prior, β) # posterior
end
u0 = [0.0, 0.0]
noise_prior = Normal(0.0, 1.0)
β_prior = Normal(β, 0.03) # prior local to the true value
joint_model_posterior(β, u0, noise, observables, noise_prior, β_prior)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">65.59047786422161</code></pre><p>Which we can turn into a differntiable objective adding in a prior on the noise</p><pre><code class="language-julia hljs">joint_model_objective(x, p) = -joint_model_posterior(x[1], u0, Matrix(x[2:end]&#39;), observables, noise_prior, β_prior) # extract noise and parameeter from vector
x0 = vcat([0.95], noise[1,:])  # starting at the true noise
joint_model_objective(x0, nothing)
gradient(x -&gt;joint_model_objective(x, nothing),x0) # Verifying it can be differentiated

# optimize
optf = OptimizationFunction(joint_model_objective, Optimization.AutoZygote())
optprob = OptimizationProblem(optf, x0)
optsol = solve(optprob,LBFGS())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 201-element Vector{Float64}:
  0.9781248023579748
  0.43078034501126583
  0.4826814165201394
  0.45378415159198576
  0.42587458043841747
  0.3567771393652693
  0.32765621284419033
  0.33628810614510163
  0.41749498394130985
  0.3181706153012164
  ⋮
 -0.012157857112918724
 -0.042650325285277034
 -0.13151415387979404
 -0.23347280138199691
 -0.18526764702487264
 -0.12163742358099854
 -0.0667500373845824
  0.004329548212652953
 -0.001316401967622679</code></pre><p>This &quot;solves&quot; the problem relatively quickly, despite the high-dimensionality.  However, from a statistics perspective note that this last optimization process does not do especially well in recovering the pseudotrue if you increase the prior variance on the <code>β</code> parameter.  Maximizing the posterior is usually the wrong thing to do in high-dimensions because the mode is not a typical set.</p><h2 id="Caveats-on-Gradients-and-Performance"><a class="docs-heading-anchor" href="#Caveats-on-Gradients-and-Performance">Caveats on Gradients and Performance</a><a id="Caveats-on-Gradients-and-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Caveats-on-Gradients-and-Performance" title="Permalink"></a></h2><p>A few notes on performance and gradients:</p><ol><li>As this is using reverse-mode AD it will be efficient for fairly large systems as long as the ultimate value of your differentiable program.  With a little extra work and unit tests, it could support structured matrices/etc. as well.</li><li>Getting to much higher scales, where the <code>A,B,C,D</code> are so large that matrix-free operators is necessary, is feasible but will require generalizing those to LinearOperators.  This would be reasonably easy for the joint likelihood and feasible but possible for the Kalman filter</li><li>At this point, there is no support for forward-mode auto-differentiation.  For smaller systems with a kalman filter, this should dominate the alternatives, and efficient forward-mode AD rules for the kalman filter exist (see the supplementary materials in the the <a href="https://github.com/HighDimensionalEconLab/DifferentiableStateSpaceModels.jl">Differentiable State Space Models</a> paper).  However, it would be a significant amount of work to add end-to-end support and fulfill standard SciML interfaces, and perhaps waiting for <a href="https://enzyme.mit.edu/julia/">Enzyme</a> or similar AD systems that provide both forward/reverse/mixed mode makes sense.</li><li>Forward-mode AD is likely inappropriate for the joint-likelihood based models since the dimensionality of the noise is always large.</li><li>The gradient rules are written using <a href="https://github.com/JuliaDiff/ChainRules.jl">ChainRules.jl</a> so in theory they will work with any supporting AD.  In practice, though, Zygote is the most tested and other systems have inconsistent support on Julia at this time.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« DifferenceEquations.jl: Discrete-Time State Space Solution Methods</a><a class="docs-footer-nextpage" href="../quadratic_state_space_examples/">Quadratic State Space Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Friday 12 August 2022 23:16">Friday 12 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
